/*! Ebl - v0.0.1 (2016-07-11) */
!function(a,b){"use strict";function c(){var b=Da.container=document.querySelector(".ebl-container");if(!o(b)){Da.docTitle=document.title;var c=b.querySelector("ebl-template"),d=M(c,"eblType");if("page"==d){var e=parseInt(M(c,"eblPageNum"),10);Ea.page=isNaN(e)?0:e}else if("post"==d){var f={};if(f.status=Ca.parse(M(c,"eblPostStatus")),f.status!=Ca.NEW){f.id=M(c,"eblPostId"),f.title=M(c,"eblPostTitle"),f.createdAt=y(M(c,"eblPostCreatedat")),f.updatedAt=y(M(c,"eblPostUpdatedat")),f.tags=w(M(c,"eblPostTags"));var g=k(location.search,"ebl-edit");null!==g&&1==parseInt(g,10)&&(f.edit=!0),oa(f.title)}else f.edit=!0;Ea.post=f}var h=[];"en"!=Da.config.language&&h.push({url:ta+"/languages/"+Da.config.language+".js",type:"js",required:!1}),h.push({url:ta+"/css/base.css",type:"css",required:!0}),u()||t()||(h.push({url:ta+"/libs/alertify/alertify.min.js",type:"js",required:!0}),h.push({url:ta+"/libs/alertify/css/alertify.min.css",type:"css",required:!0}),h.push({url:ta+"/libs/alertify/css/themes/default.min.css",type:"css",required:!1})),P(h,function(){ma(Ea,null,null,!0),la(),ha();var b=Da.container;G(b),X(b),Y(b),A(va.DATA,"action=get_session","GET",!0,null,function(b){Da.isAdmin=b.data.attributes.logged,Da.isAdmin===!0&&(Da.authToken=b.data.attributes.token),Z(),!o(Ea.post)&&Ea.post.edit&&Q(),"#ebl-login"==a.location.hash&&_()},function(a,b){if(Da.isAdmin=!1,Da.authToken=null,Z(),a===wa.EBL_ERROR_AUTH_NOADMIN)$();else{var c=a===wa.EBL_ERROR_DB_ACCESS?"There is a problem connecting to the DB: "+b.message:"General error: "+b.message;ga(ya.FATAL,c)}}),v(a,"beforeunload",function(a){if(!o(Ea.editors)){var b=z("An editor is open. If you close the window, you will lose your changes.");return a.returnValue=b,b}}),v(a,"hashchange",function(b){"#ebl-login"==a.location.hash&&_()});var c=Da.config.onBlogLoaded;"function"==typeof c&&c()})}}function d(a,b){var d=null;if(O(a)?d=a:"string"==typeof a&&(d=document.getElementById(a)),o(d))return void j("can't create Ebl on invalid element");if(!o(b))for(var e in b)b.hasOwnProperty(e)&&(Da.config[e]=b[e]);var f,g,h,i="",l=!1;null!==(f=k(location.search,"ebl-post"))&&(i+="&ebl-post="+f,l=!0),l||null===(g=k(location.search,"ebl-page"))||(i+="&ebl-page="+parseInt(g,10),l=!0),l||null===(h=k(location.search,"ebl-new"))||1!=parseInt(h,10)||(i+="&ebl-new=1",l=!0),A(va.RENDER,"action=get_html"+i+n(Da.config,"template","postsPerPage"),"GET",!1,null,function(a){d.insertAdjacentHTML("beforeend",a),c()},function(a,b){d.insertAdjacentHTML("beforeend",b)})}function e(b){var c=new Ba;c.page=b?b:0;var d=l(a.location.search,"ebl-page",c.page);d=m(d,"ebl-post"),d=m(d,"ebl-edit"),d=m(d,"ebl-new"),ma(c,null,d),W()}function f(b,c){var d=new Ba;d.post={id:b};var e=l(a.location.search,"ebl-post",d.post.id);e=m(e,"ebl-edit"),e=m(e,"ebl-page"),e=m(e,"ebl-new"),ma(d,null,e,c),U(d.post.id)}function g(){if(!Da.isAdmin)return void j("can't open editor, admin not logged");var b={};b.post={edit:!0,status:Ca.NEW};var c=l(a.location.search,"ebl-new","1");c=m(c,"ebl-post"),c=m(c,"ebl-edit"),c=m(c,"ebl-page"),ma(b,null,c),V()}function h(a){ra&&console.log("[Ebl v"+qa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function i(a){console.warn("[Ebl v"+qa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function j(a){console.error("[Ebl v"+qa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function k(a,b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a)||[,""])[1].replace(/\+/g,"%20"))||null}function l(a,b,c){if(a.indexOf(b+"=")>=0){var d=a.substring(0,a.indexOf(b)),e=a.substring(a.indexOf(b));e=e.substring(e.indexOf("=")+1),e=e.indexOf("&")>=0?e.substring(e.indexOf("&")):"",a=d+b+"="+c+e}else a+=a.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;return a}function m(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);a=c[0]+"?"+e.join("&")}return-1!==a.indexOf("?",a.length-1)&&a.slice(0,-1),a}function n(a){function b(a){return"_"+a.toLowerCase()}for(var c="",d=[],e=1;e<arguments.length;++e)d.push(arguments[e]);for(var f in a)if(!(d.length>0&&-1==d.indexOf(f))){var g=a[f];if(!o(g)&&"function"!=typeof g){"boolean"==typeof g&&(g=g?1:0);var h=f.replace(/([A-Z])/g,b);c+="&"+h+"="+g}}return c}function o(a){return"undefined"==typeof a||null===a}function p(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(a,c){a[c]=b;try{delete a[c]}catch(d){}}function r(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function t(){for(var a=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0];);if(4>=a){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/);a=e?parseInt(e[1]):b}return 9>a}function u(){return!("undefined"==typeof alertify)}function v(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c)}function w(a){var b=[];if(o(a))return b;for(var c=a.split(","),d=[],e=0;e<c.length;++e){var f=c[e].trim();f=f.replace(/ +(?= )/g,""),f=f.replace(/ /g,"-"),f=f.toLowerCase();var g={id:f};g.id.length>0&&-1==d.indexOf(g.id)&&(b.push(g),d.push(g.id))}return b}function x(a){var b="";if(o(a))return b;for(var c=0;c<a.length;++c)b+=a[c].id,c<a.length-1&&(b+=", ");return b}function y(a){var b=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?:\:(\d{2}))?/,c=b.exec(a);return new Date(+c[1],+c[2]-1,+c[3],+c[4],+c[5],c[6]?+c[6]:0)}function z(a){return"undefined"!=typeof ebl_l18n&&ebl_l18n.hasOwnProperty(a)?ebl_l18n[a]:("en"!=Da.config.language&&i("can't find translated text for key '"+a+"', language '"+Da.config.language+"'"),a)}function A(b,c,d,e,f,g,i){h("sending request... params: "+c+" | type: "+b+" | method: "+d+" | async: "+e);var k=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){if(k.readyState<4)"function"==typeof f&&f();else if(4==k.readyState){k.onreadystatechange=null;var a=k.responseText;if(200==k.status)h("response from "+b+" API: "+a),"function"==typeof g&&g(b==va.RENDER?a:JSON.parse(a));else{var c=null;c=b==va.RENDER?a:JSON.parse(a).errors[0].message,j("error "+k.status+" from "+b+" API: "+c),"function"==typeof i&&i(k.status,c)}}};try{"GET"==d?(k.open(d,ta+"/api/"+b+".php?"+c,e),k.send(null)):"POST"==d&&(k.open(d,ta+"/api/"+b+".php",e),k.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),k.send(c))}catch(l){j("error connecting to Ebl API: "+l)}}function B(a,b){return null!==a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function C(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];B(a,c)||(a.className.length>0&&(a.className+=" "),a.className+=c)}}function D(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(B(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d," "),a.className=a.className.trim()}}}function E(a,b){var c=document.createElement("button");return C(c,"ebl-button"),a&&C(c,a),b&&(c.title=b),c}function F(a,b){var c=document.createElement("span");return N(c,"tooltip",b),c.appendChild(a),c}function G(a){for(var b=a.getElementsByTagName("script"),c=0;c<b.length;c++){var d=document.createElement("script");d.innerHTML=b[c].innerHTML,b[c].parentNode.appendChild(d),b[c].parentNode.removeChild(b[c])}}function H(a,b){a.insertBefore(b,a.childNodes[0])}function I(a){o(a)||(o(a.origDisplay)?a.style.display="inline-block":a.style.display=a.origDisplay)}function J(a){o(a)||(B(a,"ebl-toolbar")?a.style.visibility="hidden":(o(a.origDisplay)&&(a.origDisplay=a.currentStyle?a.currentStyle.display:getComputedStyle(a,null).display),a.style.display="none"))}function K(a){o(a)||a.parentNode.removeChild(a)}function L(a,b,c,d,e,f,g,i){h("animating with values: "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g);var j=(new Date).getTime(),k=setInterval(function(){var h=Math.min(1,((new Date).getTime()-j)/g);d?a[b]=e+l(h)*(f-e)+c:a.style[b]=e+l(h)*(f-e)+c,1==h&&(clearInterval(k),"function"==typeof i&&i())},10);d?a[b]=e+c:a.style[b]=e+c;var l=function(a){return.5>a?2*a*a:-1+(4-2*a)*a}}function M(a,b){return a.dataset?a.dataset[b]:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.getAttribute("data-"+b))}function N(a,b,c){a.dataset?a.dataset[b]=c:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.setAttribute("data-"+b,c))}function O(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function P(a,b){function c(a){h(a+" loaded"),++e==f&&b()}function d(a,b){var c;"css"===a.type?(c=document.createElement("link"),c.rel="stylesheet",c.type="text/css",c.href=a.url,"function"==typeof b&&b(a.url)):"js"===a.type&&(c=document.createElement("script"),c.type="text/javascript",c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&(c.onreadystatechange=null,"function"==typeof b&&b(a.url))}:(c.onload=function(){"function"==typeof b&&b(a.url)},c.onerror=function(){j("error loading "+a.url),a.required||"function"!=typeof b||b(a.url)}),c.src=a.url),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(c)}var e=0,f=a.length;if(0===f)return void b();for(var g=0;f>g;)d(a[g],c),g++}function Q(){if(!Da.isAdmin)return void j("can't open editor, admin not logged");if("undefined"==typeof wysihtml){if(xa>=1)return void j("error loading editor library.");xa++,h("editor library not yet loaded. perform loading now...");var a=[];return a.push({url:ta+"/libs/wysihtml/wysihtml.min.js",type:"js"}),a.push({url:ta+"/libs/wysihtml/wysihtml.toolbar.min.js",type:"js"}),a.push({url:ta+"/libs/wysihtml/wysihtml.table_editing.min.js",type:"js"}),a.push({url:ta+"/libs/wysihtml/parser_rules/advanced_and_extended.js",type:"js"}),void P(a,function(){Q()})}R()}function R(){function b(b,d){if(!o(b)&&o(Ea.editors))return(b.target||b.srcElement).removeEventListener("click",this),!1;var e=null,f=null,g=document.documentElement,h=Math.max(g.clientWidth,a.innerWidth||0);if(s()||d){var i=l.getBoundingClientRect();e=i.left+(l.offsetWidth/2-m.offsetWidth/2),f=i.top-m.offsetHeight-5}else{var j=null,k=null;if(document.selection&&document.selection.createRange)k=document.selection.createRange(),j={top:k.offsetTop,left:k.offsetLeft};else if(a.getSelection&&a.getSelection().rangeCount>0){k=a.getSelection().getRangeAt(0).cloneRange();var n=k.getBoundingClientRect();j={top:n.top,left:n.left}}if(!o(j)){var p=m.offsetWidth/2;e=j.left-p+5,5>e?e=5:e>h-p-5&&(e=h-p-5),f=j.top-m.offsetHeight-20}}if(null!==e||null!==f){var q=(a.pageXOffset||g.scrollLeft)-(g.clientLeft||0),r=(a.pageYOffset||g.scrollTop)-(g.clientTop||0);e+=q,f+=r;var t=!0,u=parseInt(m.style.left,10);isNaN(u)&&(t=!1);var v=parseInt(m.style.top,10);return isNaN(v)&&(t=!1),m.style.visibility="visible",t?(L(m,"left","px",!1,Math.ceil(u),Math.ceil(e),300),L(m,"top","px",!1,Math.ceil(v),Math.ceil(f),300)):(m.style.left=Math.ceil(e)+"px",m.style.top=Math.ceil(f)+"px"),!0}return c(),!1}function c(){B(m,"ebl-sticky")||J(m)}function d(a){for(var c="textarea"===a,d=m.querySelectorAll(".ebl-button, .ebl-separator"),e=0;e<d.length;e++)c?J(d[e]):I(d[e]);var f=m.querySelector(".ebl-action-editor-html");c?(D(f,"ebl-icon-file-code"),C(f,"ebl-icon-file-text","ebl-icon-2x"),f.title=z("Close HTML"),I(f),C(m,"ebl-sticky")):(D(f,"ebl-icon-file-text","ebl-icon-2x"),C(f,"ebl-icon-file-code"),f.title=z("Edit HTML"),D(m,"ebl-sticky")),b({},!0)}function e(){var b=Ea.editors.title,c=b.getBoundingClientRect(),d=c.left+(b.offsetWidth/2-k.offsetWidth/2),e=c.top-k.offsetHeight-5,f=document.documentElement,g=(a.pageXOffset||f.scrollLeft)-(f.clientLeft||0),h=(a.pageYOffset||f.scrollTop)-(f.clientTop||0);return d+=g,e+=h,k.style.left=Math.ceil(d)+"px",k.style.top=Math.ceil(e)+"px",k.style.visibility="visible",!0}function f(){J(k)}function g(a){var b=a.keyCode||a.which;return 13==b?(a.preventDefault(),!1):void 0}var h={},i=Da.container.querySelector(Ea.post.status===Ca.NEW?".ebl-post-new":".ebl-post-singleview#ebl-post_"+Ea.post.id),j=i.querySelector(".ebl-post-title");C(j,"ebl-editable"),j.contentEditable=!0,Ea.post.status===Ca.NEW?j.innerHTML=z("Title here..."):j.oldValue=j.innerHTML;var k=Da.container.querySelector(".ebl-title-toolbar");o(k)&&(k=ka()),h.title=j,v(h.title,"keypress",g),v(h.title,"focus",e),v(h.title,"blur",f);var l=i.querySelector(".ebl-post-body");C(l,"ebl-editable"),l.oldValue=l.innerHTML;var m=Da.container.querySelector(".ebl-editor-toolbar");if(o(m)&&(m=ja()),h.content=new wysihtml.Editor(l,{name:"ebl-editor-body",style:!1,showToolbarAfterInit:!1,parserRules:wysihtmlParserRules,uneditableContainerClassname:!1,useLineBreaks:!1,toolbar:m}),Ea.post.status===Ca.NEW&&h.content.setValue("<p>"+z("... and content here")+"</p>"),h.content.on("newword:composer",b),h.content.on("show:dialog",function(){C(m,"ebl-sticky")}),h.content.on("cancel:dialog",function(){D(m,"ebl-sticky")}),h.content.on("blur",c),h.content.on("change_view",d),v(l,"click",b),Ea.editors=h,Ea.post.status===Ca.NEW)for(var n=i.querySelectorAll(".ebl-post-comments"),p=0;p<n.length;++p)K(n[p])}function S(a){if(J(Da.container.querySelector(".ebl-editor-toolbar")),!o(Ea.editors)){var b=Ea.editors.title,c=Ea.editors.content;b.blur(),b.contentEditable=!1,D(b,"ebl-editable"),a&&!o(b.oldValue)&&(b.innerHTML=b.oldValue),q(b,"oldValue"),c.destroy(),D(c.editableElement,"ebl-editable"),Ea.editors=null}}function T(a){if(o(Ea.editors))return void j("there is no active editor.");var b=Ea.editors.title;b.oldValue=b.innerHTML;var c=encodeURIComponent(r((b.textContent||b.innerText).trim()));if(0===c.length)return void ga(ya.ERROR,z("Title is missing!"));var d=Ea.editors.content;"source"==d.currentView&&d.fire("change_view","composer");var e=encodeURIComponent(d.getValue()),g=d.editableElement;g.oldValue=g.innerHTML,o(Ea.post.tags)&&(Ea.post.tags=[]);var h=JSON.stringify(Ea.post.tags),i=Ea.post.status===Ca.NEW,k=i?"action=publish_post&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0):"action=update_post&id="+Ea.post.id+"&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0);k+="&token="+Da.authToken,A(va.DATA,k,"POST",!0,function(){ea()},function(b){fa();var c=b.meta.id;Ea.post.id=c,Ea.post.status=a?Ca.DRAFT:Ca.PUBLISHED,a||(S(),f(c,i)),a?ga(ya.SUCCESS,z("Draft saved")):i?ga(ya.SUCCESS,z("Published!")):ga(ya.SUCCESS,z("Updated!"))},function(a,b){fa(),ga(ya.FATAL,"I can't publish this document: "+r(b))})}function U(a,b){S(),A(va.RENDER,"action=get_post&id="+a+n(Da.config,"template"),"GET",!0,function(){ea()},function(c){fa();var d=Da.container;K(d.querySelector("ebl-template")),d.insertAdjacentHTML("beforeend",c);var e=d.querySelector("ebl-template"),f=Ea.post;f.id=M(e,"eblPostId"),f.status=Ca.parse(M(e,"eblPostStatus")),f.title=M(e,"eblPostTitle"),f.createdAt=y(M(e,"eblPostCreatedat")),f.updatedAt=y(M(e,"eblPostUpdatedat")),f.tags=w(M(e,"eblPostTags")),G(e),X(e),Y(e),oa(f.title),b===!0&&Q(),ia();var g=Da.config.onPostOpened;"function"==typeof g&&g(a)},function(a,b){fa();var c=Da.container;K(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function V(){A(va.RENDER,"action=get_html&ebl-new=1"+n(Da.config,"template"),"GET",!0,function(){ea()},function(a){fa();var b=Da.container;K(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template"),d=Ea.post;d.status=Ca.NEW;for(var e=c.querySelectorAll(".ebl-comments"),f=0;f<e.length;++f)K(e[f]);G(c),X(c),Y(c),oa(z("Title here...")),Q(),ia()},function(a,b){fa();var c=Da.container;K(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function W(){S(),A(va.RENDER,"action=get_page&number="+Ea.page+n(Da.config,"template","postsPerPage"),"GET",!0,function(){ea()},function(a){fa();var b=Da.container;K(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template");Ea.page=parseInt(M(c,"eblPageNum"),0),q(Ea,"post"),G(c),X(c),Y(c),oa(null),ia();var d=Da.config.onPageChanged;"function"==typeof d&&d(Ea.page)},function(a,b){fa();var c=Da.container;K(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function X(b){for(var c=b.querySelectorAll(".ebl-post-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d=document.documentElement||document.body;L(d,"scrollTop","",!0,d.scrollTop,Da.container.offsetTop-40,400,function(){f(c.substring(c.lastIndexOf("?ebl-post=")+"?ebl-post=".length),!1)})}:i("found a post link but it's not an <a> tag! seamless navigation is disabled.")}}function Y(b){for(var c=b.querySelectorAll(".ebl-nav-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d={};d.page=parseInt(c.substring(c.lastIndexOf("?ebl-page=")+"?ebl-page=".length),10);var e=l(a.location.search,"ebl-page",d.page);e=m(e,"ebl-post");var f=document.documentElement||document.body;L(f,"scrollTop","",!0,f.scrollTop,Da.container.offsetTop-40,400,function(){ma(d,null,e),W()})}:i("found a nav link but it's not an <a> tag! seamless navigation is disabled for it.")}}function Z(){var a=Da.container.querySelector(".ebl-adminbar");Da.isAdmin?(ia(),I(a)):(S(),J(a))}function $(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ga(ya.ERROR,z("Choose a longer passphrase, it's worth it!"))):void A(va.DATA,"action=init_repository&psw="+a,"POST",!0,null,function(a){c&&c.close(),Da.isAdmin=!0,Da.authToken=a.data.attributes.token,ga(ya.SUCCESS,z("Admin created, bring it on!")),Z()},function(a,b){ga(ya.FATAL,"can't initialize database: "+b)})}if(Da.isAdmin)return void j("can't show dialog, admin already exists and it's logged.");if(u()){var b=alertify.prompt(),c=b.elements.footer.querySelector("button.ajs-cancel");J(c),b.set({title:z("Welcome to Ebl!"),message:z("Everything is ready to put some contents on your blog. But first, you need a passphrase! Create it here:"),closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:z("Ok")},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var d=prompt(z("Everything is ready to put some contents on your blog. But first, you need a passphrase! Create it here:"),"");d&&a(d)}}function _(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ga(ya.ERROR,z("Wrong passphrase :("))):void A(va.DATA,"action=log_in&psw="+a,"POST",!0,null,function(a){Da.isAdmin=!0,Da.authToken=a.data.attributes.token,ga(ya.SUCCESS,z("You have been logged in!")),c&&c.close(),Z(),o(Ea.post)&&e()},function(a,b){if(a===wa.EBL_ERROR_AUTH_SHORTACCESS);else if(a===wa.EBL_ERROR_AUTH_NOTLOGGED)ga(ya.ERROR,z("Wrong passphrase :("));else{var d="login error: "+b;c&&c.close(),ga(ya.FATAL,d),j(b)}})}if(Da.isAdmin)return void i("already logged in.");if(u()){var b=alertify.prompt();b.set({title:z("Restricted area"),message:z("Are you the master? Type the passphrase:"),closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:z("Ok"),cancel:z("Cancel")},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var c=prompt(z("Are you the master? Type the passphrase:"),"");c&&a(c)}}function aa(){function a(){A(va.DATA,"action=log_out","POST",!0,function(){ea()},function(a){if(fa(),Da.isAdmin=!1,Da.authToken=null,Z(),o(Ea.post))e();else{var b=Da.container.querySelector(".ebl-post-singleview#ebl-post_"+Ea.post.id);B(b,"ebl-draft")&&e()}},function(a,b){fa(),ga(ya.FATAL,b)})}if(!Da.isAdmin)return void j("can't show dialog, user already logged out.");if(u()){var b=alertify.confirm();b.set({title:"",message:z("Really log out?"),modal:!0,movable:!1,labels:{ok:z("Ok"),cancel:z("Cancel")},onok:a}),b.show()}else{var c=confirm(z("Really log out?"));c&&a()}}function ba(a){function b(){A(va.DATA,"action=delete_post&id="+a+"&token="+Da.authToken,"POST",!0,function(){ea()},function(a){fa(),ga(ya.SUCCESS,z("Post deleted")),q(Ea.post),W()},function(a,b){fa(),ga(ya.FATAL,"error while deleting: "+b)})}if(!Da.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.confirm();c.set({title:"",message:z("Do you really want to delete this post?"),modal:!0,movable:!1,labels:{ok:z("Ok"),cancel:z("Cancel")},onok:b}),c.show()}else{var d=confirm(z("Do you really want to delete this post?"));d&&b()}}function ca(a){if(!Da.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var b=alertify.confirm();b.set({title:"",message:z("This will take this post back to a draft status, are you sure?"),modal:!0,movable:!1,labels:{ok:z("Ok"),cancel:z("Cancel")},onok:a}),b.show()}else{var c=confirm(z("This will take this post back to a draft status, are you sure?"));c&&a()}}function da(a,b){if(!Da.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.prompt(),d=c.elements.body.querySelector("input.ajs-input");d.placeholder=z("e.g.: biscuits, coffee lovers, the-number-42"),c.set({title:z("Tags"),message:z('Write down a list of tags for this post, separated by comma. Only letters and numbers are allowed and spaces will be replaced with the "-" character.'),closable:!1,movable:!1,resizable:!1,maximizable:!1,type:"text",labels:{ok:z("Ok"),cancel:z("Cancel")},value:a,onok:function(a,c){b(c)}}),c.show()}else{var e=prompt(z('Write down a list of tags for this post, separated by comma. Only letters and numbers are allowed and spaces will be replaced with the "-" character.'));e&&b(e)}}function ea(){var a=Da.container,b=a.querySelector(".ebl-loading-overlay");if(o(b)){b=document.createElement("div"),C(b,"ebl-loading-overlay","ebl-unselectable");var c=document.createElement("div");C(c,"ebl-icon-gear","ebl-icon-spin","ebl-icon-4x"),b.appendChild(c),H(a,b)}a.style.position="relative",C(b,"visible")}function fa(){var a=Da.container,b=a.querySelector(".ebl-loading-overlay");a.style.position="static",D(b,"visible")}function ga(a,b){a==ya.SUCCESS?u()?alertify.success(b):alert(b):a==ya.ERROR?u()?alertify.error(b):alert(b):a==ya.FATAL&&(u()?alertify.alert("",'<p class="ebl-error">'+eblLang.general_fatalError+'</p><pre class="ebl-pre">'+b+"</pre>"):alert(b))}function ha(){var b=document.createElement("div");C(b,"ebl-adminbar","ebl-unselectable"),b.origDisplay="block",b.style.display="none";var c=document.createElement("div");C(c,"ebl-adminbar-new");var d=E("ebl-action-new");C(d,"ebl-icon-2x","ebl-icon-plus-square"),d.onclick=function(){g()},c.appendChild(F(d,z("Write something new")));var e=document.createElement("div");C(e,"ebl-adminbar-edit");var f=E("ebl-action-edit");C(f,"ebl-icon-2x","ebl-icon-pencil-square"),f.onclick=function(){var b=p(Ea);b.post.edit=!0;var c=l(a.location.search,"ebl-edit","1");ma(b,null,c),Q(),ia()};var h=E("ebl-action-delete");C(h,"ebl-icon-2x","ebl-icon-trash"),h.onclick=function(){ba(Ea.post.id)},e.appendChild(F(f,z("Edit this post"))),e.appendChild(F(h,z("Delete this post")));var i=document.createElement("div");C(i,"ebl-adminbar-publish");var j=E("ebl-action-save");C(j,"ebl-icon-2x","ebl-icon-floppy"),j.onclick=function(){Ea.post.status==Ca.PUBLISHED?ca(function(){T(!0)}):T(!0)};var k=E("ebl-action-publish");C(k,"ebl-icon-2x","ebl-icon-upload"),k.onclick=function(){T(!1)};var m=E("ebl-action-cancel");C(m,"ebl-icon-2x","ebl-icon-close"),m.onclick=function(){S(!0),na()},i.appendChild(F(j,z("Save as draft"))),i.appendChild(F(k,z("Publish now"))),i.appendChild(F(m,z("Cancel")));var n=E("ebl-action-logout");C(n,"ebl-icon-2x","ebl-icon-sign-out"),n.onclick=function(){aa()},b.appendChild(c),b.appendChild(e),b.appendChild(i),b.appendChild(n),H(Da.container,b),ia()}function ia(){var a=Da.container,b=a.querySelector(".ebl-adminbar-new"),c=a.querySelector(".ebl-adminbar-publish"),d=a.querySelector(".ebl-adminbar-edit");o(Ea.post)?(I(b),J(c),J(d)):Ea.post.edit===!0?(J(b),I(c),J(d)):(J(b),J(c),I(d))}function ja(){var a=document.createElement("div");C(a,"ebl-toolbar","ebl-editor-toolbar");var b=document.createElement("span");C(b,"ebl-separator");var c=document.createElement("div"),d=E("ebl-action-editor-undo",z("Undo"));C(d,"ebl-icon-rotate-left"),N(d,"wysihtmlCommand","undo");var e=E("ebl-action-editor-bold",z("Bold"));C(e,"ebl-icon-bold"),N(e,"wysihtmlCommand","bold");var f=E("ebl-action-editor-italic",z("Italic"));C(f,"ebl-icon-italic"),N(f,"wysihtmlCommand","italic");var g=E("ebl-action-editor-underline",z("Underline"));C(g,"ebl-icon-underline"),N(g,"wysihtmlCommand","underline");var h=E("ebl-action-editor-h1",z("H1"));C(h,"ebl-icon-header"),N(h,"wysihtmlCommand","formatBlock"),N(h,"wysihtmlCommandValue","h1");var i=E("ebl-action-editor-alignleft",z("Align left"));C(i,"ebl-icon-align-left"),N(i,"wysihtmlCommand","justifyLeft");var j=E("ebl-action-editor-aligncenter",z("Align center"));C(j,"ebl-icon-align-center"),N(j,"wysihtmlCommand","justifyCenter");var k=E("ebl-action-editor-alignright",z("Align right"));C(k,"ebl-icon-align-right"),N(k,"wysihtmlCommand","justifyRight");var l=E("ebl-action-editor-addul",z("Unordered list"));C(l,"ebl-icon-list-ul"),N(l,"wysihtmlCommand","insertUnorderedList");var m=E("ebl-action-editor-addol",z("Ordered list"));C(m,"ebl-icon-list-ol"),N(m,"wysihtmlCommand","insertOrderedList");var n=E("ebl-action-editor-addimage",z("Add image"));C(n,"ebl-icon-image"),N(n,"wysihtmlCommand","insertImage");var o=E("ebl-action-editor-addlink",z("Add link"));C(o,"ebl-icon-chain"),N(o,"wysihtmlCommand","createLink");var p=E("ebl-action-editor-html",z("Edit HTML"));C(p,"ebl-icon-file-code"),N(p,"wysihtmlAction","change_view"),c.appendChild(d),c.appendChild(b.cloneNode(!0)),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(b.cloneNode(!0)),c.appendChild(i),c.appendChild(j),c.appendChild(k),c.appendChild(b.cloneNode(!0)),c.appendChild(l),c.appendChild(m),c.appendChild(b.cloneNode(!0)),c.appendChild(n),c.appendChild(o),c.appendChild(b.cloneNode(!0)),c.appendChild(p);var q=document.createElement("div");N(q,"wysihtmlDialog","insertImage"),C(q,"ebl-editor-toolbar-sub","toolbar-sub-2");var r=document.createElement("input");N(r,"wysihtmlDialogField","src"),r.type="text",r.value="http://";var s=E("ebl-action-editor-image-save",z("Add image"));s.innerHTML=z("Add image"),N(s,"wysihtmlDialogAction","save"),q.appendChild(r),q.appendChild(s),J(q);var t=document.createElement("div");N(t,"wysihtmlDialog","createLink"),C(t,"ebl-editor-toolbar-sub","toolbar-sub-2");var u=document.createElement("input");N(u,"wysihtmlDialogField","href"),u.type="text",u.value="http://";var v=E("ebl-action-editor-link-save",z("Add link"));return v.innerHTML=z("Add link"),N(v,"wysihtmlDialogAction","save"),t.appendChild(u),t.appendChild(v),J(t),a.appendChild(c),a.appendChild(q),a.appendChild(t),a.style.visibility="hidden",H(Da.container,a),a}function ka(){var a=document.createElement("div");C(a,"ebl-toolbar","ebl-title-toolbar");var b=E("ebl-action-title-tag",z("Tags"));return C(b,"ebl-icon-tags"),b.onmousedown=function(){da(x(Ea.post.tags),function(a){Ea.post.tags=w(a)})},a.appendChild(b),a.style.visibility="hidden",H(Da.container,a),a}function la(){return pa()?void v(a,"popstate",function(a){a.state&&a.state.hasOwnProperty("ebl")&&(Ea=a.state.ebl,o(Ea.post)?W():Ea.post.status===Ca.NEW?V():U(Ea.post.id,Ea.post.edit))},!1):void i("this browser does not support History API. seamless navigation is disabled.")}function ma(b,c,d,e){if(pa()){var f=history.state;o(f)&&(f={}),f.ebl=Ea=b,e?history.replaceState(f,null,d):history.pushState(f,null,d)}else e||(a.location.search=d);e||(za=!0)}function na(b){za?a.history.back(b):W()}function oa(a){if(!o(Da.config.pageTitleFormat)){var b=Da.docTitle,c=null;c=o(a)?b:Da.config.pageTitleFormat.replace(/{doc_title}/g,b).replace(/{ebl_title}/g,r(a));try{document.getElementsByTagName("title")[0].innerHTML=c}catch(d){}document.title=c}}function pa(){return!(!a.history||!history.pushState)}var qa=a.Ebl={};qa.version="0.0.1";var ra=!0,sa=document.getElementsByTagName("script"),ta=sa[sa.length-1].src.split("?")[0].split("/").slice(0,-1).join("/");a.getComputedStyle||(a.getComputedStyle=function(a,b){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e-1,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),qa.init=function(a,b){d(a,b)},qa.showLogin=function(){_()},qa.openPreviews=function(){e()},qa.openPost=function(a){f(a,!1)},qa.createNew=function(){g()};var ua=function(){};ua.extend=function(a,b){var c=ua.prototype.extend;ua._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete ua._prototyping;var e=d.constructor,f=d.constructor=function(){if(!ua._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},ua.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||ua.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=ua.toString}this[a]=b}else if(a){var e=ua.prototype.extend;ua._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=ua._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},ua=ua.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,c,d){for(var e in a)this.prototype[e]===b&&c.call(d,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var va={DATA:"data",RENDER:"render"},wa={EBL_SUCCESS:200,EBL_ERROR_BADREQUEST:400,EBL_ERROR_AUTH_NOTLOGGED:401,EBL_ERROR_NOTFOUND:404,EBL_ERROR_AUTH_SHORTACCESS:429,EBL_ERROR_AUTH_NOADMIN:450,EBL_ERROR_AUTH_ALREADYADMIN:451,EBL_ERROR_AUTH_TOOMANYADMINS:452,EBL_ERROR_INTERNAL:500,EBL_ERROR_DB_ACCESS:550,EBL_ERROR_DB_INSERT:551,EBL_ERROR_DB_UPDATE:552},xa=0;document.createElement("ebl-template"),document.createElement("header"),document.createElement("time"),document.createElement("nav"),document.createElement("article");var ya={FATAL:0,ERROR:1,SUCCESS:2},za=!1,Aa=ua.extend({constructor:function(){this.isAdmin=!1,this.authToken=null,this.docTitle=null,this.container=null,this.config={template:"default",language:"en",postsPerPage:5,pageTitleFormat:"{ebl_title} | {doc_title}",onBlogLoaded:null,
onPostOpened:null,onPageChanged:null}}}),Ba=ua.extend({constructor:function(){this.page=0,this.post=null,this.editors=null}}),Ca={NEW:0,DRAFT:1,PUBLISHED:2,parse:function(a){return"new"==a.toLowerCase()?0:"draft"==a.toLowerCase()?1:"published"==a.toLowerCase()?2:null}},Da=new Aa,Ea=new Ba}(window);