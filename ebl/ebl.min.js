/*! Ebl - v0.0.1 (2015-09-17) */

!function(a,b){"use strict";function c(){var b=Aa.container=document.querySelector(".ebl-container");if(!o(b)){Aa.originalTitle=document.title;var c=b.querySelector("ebl-template"),d=I(c,"eblType");if("page"==d){var e=parseInt(I(c,"eblPageNum"),10);Ba.page=isNaN(e)?0:e}else if("post"==d){var f={};if(f.status=za.parse(I(c,"eblPostStatus")),f.status!=za.NEW){f.id=I(c,"eblPostId"),f.title=I(c,"eblPostTitle"),f.tags=v(I(c,"eblPostTags"));var g=k(location.search,"ebl-edit");null!==g&&1==parseInt(g,10)&&(f.edit=!0),ka(f.title)}else f.edit=!0;Ba.post=f}var h=[];h.push({url:pa+"/languages/"+Aa.config.language+".js",type:"js"}),h.push({url:pa+"/css/base.css",type:"css"}),h.push({url:pa+"/css/font-awesome/css/font-awesome.min.css",type:"css"}),t()||s()||(h.push({url:pa+"/libs/alertify/alertify.min.js",type:"js"}),h.push({url:pa+"/libs/alertify/css/alertify.min.css",type:"css"}),h.push({url:pa+"/libs/alertify/css/themes/default.min.css",type:"css"})),L(h,function(){ia(Ba,null,null,!0),ha(),da();var b=Aa.container;C(b),T(b),U(b),w(ra.DATA,"action=get_session","GET",!0,null,function(b){Aa.isAdmin=b.data.attributes.logged,Aa.isAdmin===!0&&(Aa.authToken=b.data.attributes.token),V(),!o(Ba.post)&&Ba.post.edit&&M(),"#ebl-login"==a.location.hash&&X()},function(a,b){if(Aa.isAdmin=!1,Aa.authToken=null,V(),a===sa.EBL_ERROR_AUTH_NOADMIN)W();else{var c=a===sa.EBL_ERROR_DB_ACCESS?"There is a problem connecting to the DB: "+b.message:"General error: "+b.message;ca(ua.FATAL,c)}}),u(a,"beforeunload",function(a){return o(Ba.editors)?void 0:eblLang.editor_closeWarning}),u(a,"hashchange",function(b){"#ebl-login"==a.location.hash&&X()});var c=Aa.config.onBlogLoaded;"function"==typeof c&&c()})}}function d(a,b){var d=null;if(K(a)?d=a:"string"==typeof a&&(d=document.getElementById(a)),o(d))return void j("can't create Ebl on invalid element");if(!o(b))for(var e in b)b.hasOwnProperty(e)&&(Aa.config[e]=b[e]);var f,g,h,i="",l=!1;null!==(f=k(location.search,"ebl-post"))&&(i+="&ebl-post="+f,l=!0),l||null===(g=k(location.search,"ebl-page"))||(i+="&ebl-page="+parseInt(g,10),l=!0),l||null===(h=k(location.search,"ebl-new"))||1!=parseInt(h,10)||(i+="&ebl-new=1",l=!0),w(ra.RENDER,"action=get_html"+i+n(Aa.config,"template","postsPerPage"),"GET",!1,null,function(a){d.insertAdjacentHTML("beforeend",a),c()},function(a,b){d.insertAdjacentHTML("beforeend",b)})}function e(b){var c=new ya;c.page=b?b:0;var d=l(a.location.search,"ebl-page",c.page);d=m(d,"ebl-post"),d=m(d,"ebl-edit"),d=m(d,"ebl-new"),ia(c,null,d),S()}function f(b,c){var d=new ya;d.post={id:b};var e=l(a.location.search,"ebl-post",d.post.id);e=m(e,"ebl-edit"),e=m(e,"ebl-page"),e=m(e,"ebl-new"),ia(d,null,e,c),Q(d.post.id)}function g(){if(!Aa.isAdmin)return void j("can't open editor, admin not logged");var b={};b.post={edit:!0,status:za.NEW};var c=l(a.location.search,"ebl-new","1");c=m(c,"ebl-post"),c=m(c,"ebl-edit"),c=m(c,"ebl-page"),ia(b,null,c),R()}function h(a){na&&console.log("[Ebl v"+ma.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function i(a){console.warn("[Ebl v"+ma.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function j(a){console.error("[Ebl v"+ma.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function k(a,b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a)||[,""])[1].replace(/\+/g,"%20"))||null}function l(a,b,c){if(a.indexOf(b+"=")>=0){var d=a.substring(0,a.indexOf(b)),e=a.substring(a.indexOf(b));e=e.substring(e.indexOf("=")+1),e=e.indexOf("&")>=0?e.substring(e.indexOf("&")):"",a=d+b+"="+c+e}else a+=a.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;return a}function m(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-->0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);a=c[0]+"?"+e.join("&")}return-1!==a.indexOf("?",a.length-1)&&a.slice(0,-1),a}function n(a){function b(a){return"_"+a.toLowerCase()}for(var c="",d=[],e=1;e<arguments.length;++e)d.push(arguments[e]);for(var f in a)if(!(d.length>0&&-1==d.indexOf(f))){var g=a[f];if(!o(g)&&"function"!=typeof g){"boolean"==typeof g&&(g=g?1:0);var h=f.replace(/([A-Z])/g,b);c+="&"+h+"="+g}}return c}function o(a){return"undefined"==typeof a||null===a}function p(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function s(){for(var a=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0];);if(4>=a){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/);a=e?parseInt(e[1]):b}return 9>a}function t(){return!("undefined"==typeof alertify)}function u(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c)}function v(a){for(var b=[],c=a.split(","),d=0;d<c.length;++d)b.push({id:c[d]});return b}function w(b,c,d,e,f,g,i){h("sending request... params: "+c+" | type: "+b+" | method: "+d+" | async: "+e);var k=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){if(k.readyState<4)"function"==typeof f&&f();else if(4==k.readyState){k.onreadystatechange=null;var a=k.responseText;if(200==k.status)h("response from "+b+" API: "+a),"function"==typeof g&&g(b==ra.RENDER?a:JSON.parse(a));else{var c=null;c=b==ra.RENDER?a:JSON.parse(a).errors[0].message,j("error "+k.status+" from "+b+" API: "+c),"function"==typeof i&&i(k.status,c)}}};try{"GET"==d?(k.open(d,pa+"/api/"+b+".php?"+c,e),k.send(null)):"POST"==d&&(k.open(d,pa+"/api/"+b+".php",e),k.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),k.send(c))}catch(l){j("error connecting to Ebl API: "+l)}}function x(a,b){return null!==a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function y(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];x(a,c)||(a.className.length>0&&(a.className+=" "),a.className+=c)}}function z(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(x(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d," "),a.className=a.className.trim()}}}function A(a,b){var c=document.createElement("button");return y(c,"ebl-button"),a&&y(c,a),b&&(c.title=b),c}function B(a,b){var c=document.createElement("span");return J(c,"tooltip",b),c.appendChild(a),c}function C(a){for(var b=a.getElementsByTagName("script"),c=0;c<b.length;c++){var d=document.createElement("script");d.innerHTML=b[c].innerHTML,b[c].parentNode.appendChild(d),b[c].parentNode.removeChild(b[c])}}function D(a,b){a.insertBefore(b,a.childNodes[0])}function E(a){o(a)||(o(a.origDisplay)?a.style.display="inline-block":a.style.display=a.origDisplay)}function F(a){o(a)||(x(a,"ebl-toolbar")?a.style.visibility="hidden":(o(a.origDisplay)&&(a.origDisplay=a.currentStyle?a.currentStyle.display:getComputedStyle(a,null).display),a.style.display="none"))}function G(a){o(a)||a.parentNode.removeChild(a)}function H(a,b,c,d,e,f,g,i){h("animating with values: "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g);var j=(new Date).getTime(),k=setInterval(function(){var h=Math.min(1,((new Date).getTime()-j)/g);d?a[b]=e+l(h)*(f-e)+c:a.style[b]=e+l(h)*(f-e)+c,1==h&&(clearInterval(k),"function"==typeof i&&i())},10);d?a[b]=e+c:a.style[b]=e+c;var l=function(a){return.5>a?2*a*a:-1+(4-2*a)*a}}function I(a,b){return a.dataset?a.dataset[b]:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.getAttribute("data-"+b))}function J(a,b,c){a.dataset?a.dataset[b]=c:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.setAttribute("data-"+b,c))}function K(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function L(a,b){function c(a){h(a+" loaded"),++e==f&&b()}function d(a,b,c){var d;"css"===b?(d=document.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=a,"function"==typeof c&&c(a)):"js"===b&&(d=document.createElement("script"),d.type="text/javascript",d.readyState?d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,"function"==typeof c&&c(a))}:(d.onload=function(){"function"==typeof c&&c(a)},d.onerror=function(){j("error loading "+a)}),d.src=a),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)}var e=0,f=a.length;if(0===f)return void b();for(var g=0;f>g;)d(a[g].url,a[g].type,c),g++}function M(){if(!Aa.isAdmin)return void j("can't open editor, admin not logged");if("undefined"==typeof wysihtml5){if(ta>=1)return void j("error loading editor library.");ta++,h("editor library not yet loaded. perform loading now...");var a=[];return a.push({url:pa+"/libs/wysihtml/wysihtml-toolbar.min.js",type:"js"}),void L(a,function(){a=[],a.push({url:pa+"/libs/wysihtml/parser_rules/advanced_and_extended.js",type:"js"}),L(a,function(){M()})})}N(),ea(va.SAVE_CHANGES)}function N(){function b(b,d){if(!o(b)&&o(Ba.editors))return(b.target||b.srcElement).removeEventListener("click",this),!1;var e=null,f=null,g=document.documentElement,h=Math.max(g.clientWidth,a.innerWidth||0);if(r()||d){var i=l.getBoundingClientRect();e=i.left+(l.offsetWidth/2-m.offsetWidth/2),f=i.top-m.offsetHeight-5}else{var j=null,k=null;if(document.selection&&document.selection.createRange)k=document.selection.createRange(),j={top:k.offsetTop,left:k.offsetLeft};else if(a.getSelection&&a.getSelection().rangeCount>0){k=a.getSelection().getRangeAt(0).cloneRange();var n=k.getBoundingClientRect();j={top:n.top,left:n.left}}if(!o(j)){var p=m.offsetWidth/2;e=j.left-p+5,5>e?e=5:e>h-p-5&&(e=h-p-5),f=j.top-m.offsetHeight-20}}if(null!==e||null!==f){var q=(a.pageXOffset||g.scrollLeft)-(g.clientLeft||0),s=(a.pageYOffset||g.scrollTop)-(g.clientTop||0);e+=q,f+=s;var t=!0,u=parseInt(m.style.left,10);isNaN(u)&&(t=!1);var v=parseInt(m.style.top,10);return isNaN(v)&&(t=!1),m.style.visibility="visible",t?(H(m,"left","px",!1,Math.ceil(u),Math.ceil(e),300),H(m,"top","px",!1,Math.ceil(v),Math.ceil(f),300)):(m.style.left=Math.ceil(e)+"px",m.style.top=Math.ceil(f)+"px"),!0}return c(),!1}function c(){x(m,"ebl-sticky")||F(m)}function d(a){for(var c="textarea"===a,d=m.querySelectorAll(".ebl-button, .ebl-separator"),e=0;e<d.length;e++)c?F(d[e]):E(d[e]);var f=m.querySelector(".ebl-action-editor-html");c?(z(f,"fa-file-code-o"),y(f,"fa-file-text-o","fa-2x"),f.title=eblLang.editor_toolbar_closeHTML,E(f),y(m,"ebl-sticky")):(z(f,"fa-file-text-o","fa-2x"),y(f,"fa-file-code-o"),f.title=eblLang.editor_toolbar_editHTML,z(m,"ebl-sticky")),b({},!0)}function e(){var b=Ba.editors.title,c=b.getBoundingClientRect(),d=c.left+(b.offsetWidth/2-k.offsetWidth/2),e=c.top-k.offsetHeight-5,f=document.documentElement,g=(a.pageXOffset||f.scrollLeft)-(f.clientLeft||0),h=(a.pageYOffset||f.scrollTop)-(f.clientTop||0);return d+=g,e+=h,k.style.left=Math.ceil(d)+"px",k.style.top=Math.ceil(e)+"px",k.style.visibility="visible",!0}function f(){F(k)}function g(a){var b=a.keyCode||a.which;return 13==b?(a.preventDefault(),!1):void 0}var h={},i=Aa.container.querySelector(Ba.post.status===za.NEW?".ebl-post-new":".ebl-post-singleview#ebl-post_"+Ba.post.id),j=i.querySelector(".ebl-post-title");y(j,"ebl-editable"),j.contentEditable=!0,Ba.post.status===za.NEW?j.innerHTML=eblLang.editor_placeholder_title:j.oldValue=j.innerHTML;var k=Aa.container.querySelector(".ebl-title-toolbar");o(k)&&(k=ga()),h.title=j,u(h.title,"keypress",g),u(h.title,"focus",e),u(h.title,"blur",f);var l=i.querySelector(".ebl-post-body");y(l,"ebl-editable"),l.oldValue=l.innerHTML;var m=Aa.container.querySelector(".ebl-editor-toolbar");if(o(m)&&(m=fa()),h.content=new wysihtml5.Editor(l,{name:"ebl-editor-body",style:!1,showToolbarAfterInit:!1,parserRules:wysihtml5ParserRules,uneditableContainerClassname:!1,useLineBreaks:!1,toolbar:m}),Ba.post.status===za.NEW&&h.content.setValue("<p>"+eblLang.editor_placeholder_content+"</p>"),h.content.on("newword:composer",b),h.content.on("show:dialog",function(){y(m,"ebl-sticky")}),h.content.on("cancel:dialog",function(){z(m,"ebl-sticky")}),h.content.on("blur",c),h.content.on("change_view",d),u(l,"click",b),Ba.editors=h,Ba.post.status===za.NEW)for(var n=i.querySelectorAll(".ebl-comments"),p=0;p<n.length;++p)G(n[p])}function O(a){if(F(Aa.container.querySelector(".ebl-editor-toolbar")),ea(va.EDIT_CURRENT),!o(Ba.editors)){var b=Ba.editors.title,c=Ba.editors.content;b.blur(),b.contentEditable=!1,z(b,"ebl-editable"),a&&b.hasOwnProperty("oldValue")&&(b.innerHTML=b.oldValue),delete b.oldValue,c.destroy(),z(c.editableElement,"ebl-editable"),Ba.editors=null}}function P(a){if(o(Ba.editors))return void j("there is no active editor.");var b=Ba.editors.title;b.oldValue=b.innerHTML;var c=encodeURIComponent(q((b.textContent||b.innerText).trim()));if(0===c.length)return void ca(ua.ERROR,eblLang.editor_missingTitle);var d=Ba.editors.content;"source"==d.currentView&&d.fire("change_view","composer");var e=encodeURIComponent(d.getValue()),g=d.editableElement;g.oldValue=g.innerHTML,o(Ba.post.tags)&&(Ba.post.tags=[]);var h=JSON.stringify(Ba.post.tags),i=Ba.post.status===za.NEW,k=i?"action=publish_post&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0):"action=update_post&id="+Ba.post.id+"&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0);k+="&token="+Aa.authToken,w(ra.DATA,k,"POST",!0,function(){aa()},function(b){ba();var c=b.meta.id;Ba.post.id=c,Ba.post.status=a?za.DRAFT:za.PUBLISHED,a||(O(),f(c,i)),a?ca(ua.SUCCESS,eblLang.editor_saved):i?ca(ua.SUCCESS,eblLang.editor_published):ca(ua.SUCCESS,eblLang.editor_updated)},function(a,b){ba(),ca(ua.FATAL,"I can't publish this document: "+q(b))})}function Q(a,b){O(),w(ra.RENDER,"action=get_post&id="+a+n(Aa.config,"template"),"GET",!0,function(){aa()},function(c){ba();var d=Aa.container;G(d.querySelector("ebl-template")),d.insertAdjacentHTML("beforeend",c);var e=d.querySelector("ebl-template"),f=Ba.post;f.id=I(e,"eblPostId"),f.status=za.parse(I(e,"eblPostStatus")),f.title=I(e,"eblPostTitle"),f.tags=[];for(var g=I(e,"eblPostTags").split(","),h=0;h<g.length;++h)f.tags.push({id:g[h]});C(e),T(e),U(e),ka(f.title),b===!0?M():ea(va.EDIT_CURRENT);var i=Aa.config.onPostOpened;"function"==typeof i&&i(a)},function(a,b){ba();var c=Aa.container;G(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function R(){w(ra.RENDER,"action=get_html&ebl-new=1"+n(Aa.config,"template"),"GET",!0,function(){aa()},function(a){ba();var b=Aa.container;G(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template"),d=Ba.post;d.status=za.NEW;for(var e=c.querySelectorAll(".ebl-comments"),f=0;f<e.length;++f)G(e[f]);C(c),T(c),U(c),ka(eblLang.editor_placeholder_title),M()},function(a,b){ba();var c=Aa.container;G(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function S(){O(),w(ra.RENDER,"action=get_page&number="+Ba.page+n(Aa.config,"template","postsPerPage"),"GET",!0,function(){aa()},function(a){ba();var b=Aa.container;G(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template");Ba.page=parseInt(I(c,"eblPageNum"),0),C(c),T(c),U(c),ka(null);var d=Aa.config.onPageChanged;"function"==typeof d&&d(Ba.page)},function(a,b){ba();var c=Aa.container;G(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)}),ea(va.CREATE_NEW)}function T(b){for(var c=b.querySelectorAll(".ebl-post-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d=document.documentElement||document.body;H(d,"scrollTop","",!0,d.scrollTop,Aa.container.offsetTop-40,400,function(){f(c.substring(c.lastIndexOf("?ebl-post=")+"?ebl-post=".length),!1)})}:i("found a post link but it's not an <a> tag! seamless navigation is disabled.")}}function U(b){for(var c=b.querySelectorAll(".ebl-nav-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d={};d.page=parseInt(c.substring(c.lastIndexOf("?ebl-page=")+"?ebl-page=".length),10);var e=l(a.location.search,"ebl-page",d.page);e=m(e,"ebl-post");var f=document.documentElement||document.body;H(f,"scrollTop","",!0,f.scrollTop,Aa.container.offsetTop-40,400,function(){ia(d,null,e),S()})}:i("found a nav link but it's not an <a> tag! seamless navigation is disabled for it.")}}function V(){var a=Aa.container.querySelector(".ebl-adminbar");Aa.isAdmin?E(a):(O(),F(a))}function W(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ca(ua.ERROR,eblLang.init_shortPassword)):void w(ra.DATA,"action=init_repository&psw="+a,"POST",!0,null,function(a){c&&c.close(),Aa.isAdmin=!0,Aa.authToken=a.data.attributes.token,ca(ua.SUCCESS,eblLang.init_ok),V()},function(a,b){ca(ua.FATAL,"can't initialize database: "+b)})}if(Aa.isAdmin)return void j("can't show dialog, admin already exists and it's logged.");if(t()){var b=alertify.prompt(),c=b.elements.footer.querySelector("button.ajs-cancel");F(c),b.set({title:eblLang.init_title,message:eblLang.init_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var d=prompt(eblLang.init_message,"");d&&a(d)}}function X(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ca(ua.ERROR,eblLang.login_badPassword)):void w(ra.DATA,"action=log_in&psw="+a,"POST",!0,null,function(a){Aa.isAdmin=!0,Aa.authToken=a.data.attributes.token,ca(ua.SUCCESS,eblLang.login_ok),c&&c.close(),V(),o(Ba.post)&&e()},function(a,b){if(a===sa.EBL_ERROR_AUTH_SHORTACCESS);else if(a===sa.EBL_ERROR_AUTH_NOTLOGGED)ca(ua.ERROR,eblLang.login_badPassword);else{var d="login error: "+b;c&&c.close(),ca(ua.FATAL,d),j(b)}})}if(Aa.isAdmin)return void i("already logged in.");if(t()){var b=alertify.prompt();b.set({title:eblLang.login_title,message:eblLang.login_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var c=prompt(eblLang.login_message,"");c&&a(c)}}function Y(){function a(){w(ra.DATA,"action=log_out","POST",!0,function(){aa()},function(a){if(ba(),Aa.isAdmin=!1,Aa.authToken=null,V(),o(Ba.post))e();else{var b=Aa.container.querySelector(".ebl-post-singleview#ebl-post_"+Ba.post.id);x(b,"ebl-draft")&&e()}},function(a,b){ba(),ca(ua.FATAL,b)})}if(!Aa.isAdmin)return void j("can't show dialog, user already logged out.");if(t()){var b=alertify.confirm();b.set({title:"",message:eblLang.logout_message,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.logout_message);c&&a()}}function Z(a){function b(){w(ra.DATA,"action=delete_post&id="+a+"&token="+Aa.authToken,"POST",!0,function(){aa()},function(a){ba(),ca(ua.SUCCESS,eblLang.deletepost_ok),S()},function(a,b){ba(),ca(ua.FATAL,"error while deleting: "+b)})}if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(t()){var c=alertify.confirm();c.set({title:"",message:eblLang.deletepost_confirm,modal:!0,movable:!1,onok:b}),c.show()}else{var d=confirm(eblLang.deletepost_confirm);d&&b()}}function $(a){if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(t()){var b=alertify.confirm();b.set({title:"",message:eblLang.redraft_confirm,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.redraft_confirm);c&&a()}}function _(a,b){if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(t()){var c=alertify.prompt(),d=c.elements.body.querySelector("input.ajs-input");d.placeholder=eblLang.tags_placeholder,c.set({title:eblLang.tags_title,message:eblLang.tags_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,type:"text",labels:{ok:eblLang.general_ok},value:a,onok:function(a,c){b(c)}}),c.show()}else{var e=prompt(eblLang.tags_message);e&&b(e)}}function aa(){var a=Aa.container,b=a.querySelector(".ebl-loading-overlay");if(o(b)){b=document.createElement("div"),y(b,"ebl-loading-overlay","ebl-unselectable");var c=document.createElement("div");y(c,"fa","fa-cog","fa-spin","fa-4x"),b.appendChild(c),D(a,b)}a.style.position="relative",y(b,"visible")}function ba(){var a=Aa.container,b=a.querySelector(".ebl-loading-overlay");a.style.position="static",z(b,"visible")}function ca(a,b){a==ua.SUCCESS?t()?alertify.success(b):alert(b):a==ua.ERROR?t()?alertify.error(b):alert(b):a==ua.FATAL&&(t()?alertify.alert("",'<p class="ebl-error">'+eblLang.general_fatalError+'</p><pre class="ebl-pre">'+b+"</pre>"):alert(b))}function da(){var b=document.createElement("div");y(b,"ebl-adminbar","ebl-unselectable");var c=document.createElement("div");y(c,"ebl-adminbar-new");var d=A("ebl-action-new");y(d,"fa","fa-2x","fa-plus-square-o"),d.onclick=function(){g()},c.appendChild(B(d,eblLang.button_addNew));var e=document.createElement("div");y(e,"ebl-adminbar-edit");var f=A("ebl-action-edit");y(f,"fa","fa-2x","fa-pencil-square-o"),f.onclick=function(){var b=p(Ba);b.post.edit=!0;var c=l(a.location.search,"ebl-edit","1");ia(b,null,c),M()};var h=A("ebl-action-delete");y(h,"fa","fa-2x","fa-trash-o"),h.onclick=function(){Z(Ba.post.id)},e.appendChild(B(f,eblLang.button_editPost)),e.appendChild(B(h,eblLang.button_deletePost));var i=document.createElement("div");y(i,"ebl-adminbar-publish");var j=A("ebl-action-save");y(j,"fa","fa-2x","fa-floppy-o"),j.onclick=function(){Ba.post.status==za.PUBLISHED?$(function(){P(!0)}):P(!0)};var k=A("ebl-action-publish");y(k,"fa","fa-2x","fa-cloud-upload"),k.onclick=function(){P(!1)};var m=A("ebl-action-cancel");y(m,"fa","fa-2x","fa-times"),m.onclick=function(){O(!0),ja()},i.appendChild(B(j,eblLang.button_saveDraft)),i.appendChild(B(k,eblLang.button_publishPost)),i.appendChild(B(m,eblLang.general_cancel));var n=A("ebl-action-logout");y(n,"fa","fa-2x","fa-sign-out"),n.onclick=function(){Y()},b.appendChild(c),b.appendChild(e),b.appendChild(i),b.appendChild(n),D(Aa.container,b),ea(o(Ba.post)?va.CREATE_NEW:Ba.post.status===za.NEW?va.SAVE_CHANGES:va.EDIT_CURRENT)}function ea(a){var b=Aa.container,c=b.querySelector(".ebl-adminbar-new"),d=b.querySelector(".ebl-adminbar-edit"),e=b.querySelector(".ebl-adminbar-publish");a==va.CREATE_NEW?(E(c),F(d),F(e)):a==va.EDIT_CURRENT?(F(c),E(d),F(e)):a==va.SAVE_CHANGES&&(F(c),F(d),E(e))}function fa(){var a=document.createElement("div");y(a,"ebl-toolbar","ebl-editor-toolbar");var b=document.createElement("span");y(b,"ebl-separator");var c=document.createElement("div"),d=A("ebl-action-editor-undo",eblLang.editor_toolbar_undo);y(d,"fa","fa-undo"),J(d,"wysihtml5Command","undo");var e=A("ebl-action-editor-bold",eblLang.editor_toolbar_textBold);y(e,"fa","fa-bold"),J(e,"wysihtml5Command","bold");var f=A("ebl-action-editor-italic",eblLang.editor_toolbar_textItalic);y(f,"fa","fa-italic"),J(f,"wysihtml5Command","italic");var g=A("ebl-action-editor-underline",eblLang.editor_toolbar_textUnderline);y(g,"fa","fa-underline"),J(g,"wysihtml5Command","underline");var h=A("ebl-action-editor-h1",eblLang.editor_toolbar_textH1);y(h,"fa","fa-header"),J(h,"wysihtml5Command","formatBlock"),J(h,"wysihtml5CommandValue","h1");var i=A("ebl-action-editor-alignleft",eblLang.editor_toolbar_textAlignLeft);y(i,"fa","fa-align-left"),J(i,"wysihtml5Command","justifyLeft");var j=A("ebl-action-editor-aligncenter",eblLang.editor_toolbar_textAlignCenter);y(j,"fa","fa-align-center"),J(j,"wysihtml5Command","justifyCenter");var k=A("ebl-action-editor-alignright",eblLang.editor_toolbar_textAlignRight);y(k,"fa","fa-align-right"),J(k,"wysihtml5Command","justifyRight");var l=A("ebl-action-editor-addul",eblLang.editor_toolbar_addUl);y(l,"fa","fa-list-ul"),J(l,"wysihtml5Command","insertUnorderedList");var m=A("ebl-action-editor-addol",eblLang.editor_toolbar_addOl);y(m,"fa","fa-list-ol"),J(m,"wysihtml5Command","insertOrderedList");var n=A("ebl-action-editor-addimage",eblLang.editor_toolbar_addImage);y(n,"fa","fa-picture-o"),J(n,"wysihtml5Command","insertImage");var o=A("ebl-action-editor-addlink",eblLang.editor_toolbar_addLink);y(o,"fa","fa-link"),J(o,"wysihtml5Command","createLink");var p=A("ebl-action-editor-html",eblLang.editor_toolbar_editHTML);y(p,"fa","fa-file-code-o"),J(p,"wysihtml5Action","change_view"),c.appendChild(d),c.appendChild(b.cloneNode(!0)),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(b.cloneNode(!0)),c.appendChild(i),c.appendChild(j),c.appendChild(k),c.appendChild(b.cloneNode(!0)),c.appendChild(l),c.appendChild(m),c.appendChild(b.cloneNode(!0)),c.appendChild(n),c.appendChild(o),c.appendChild(b.cloneNode(!0)),c.appendChild(p);var q=document.createElement("div");J(q,"wysihtml5Dialog","insertImage"),y(q,"ebl-editor-toolbar-sub","toolbar-sub-2");var r=document.createElement("input");J(r,"wysihtml5DialogField","src"),r.type="text",r.value="http://";var s=A("ebl-action-editor-image-save",eblLang.editor_toolbar_addImage);s.innerHTML=eblLang.editor_toolbar_addImage,J(s,"wysihtml5DialogAction","save"),q.appendChild(r),q.appendChild(s),F(q);var t=document.createElement("div");J(t,"wysihtml5Dialog","createLink"),y(t,"ebl-editor-toolbar-sub","toolbar-sub-2");var u=document.createElement("input");J(u,"wysihtml5DialogField","href"),u.type="text",u.value="http://";var v=A("ebl-action-editor-link-save",eblLang.editor_toolbar_addLink);return v.innerHTML=eblLang.editor_toolbar_addLink,J(v,"wysihtml5DialogAction","save"),t.appendChild(u),t.appendChild(v),F(t),a.appendChild(c),a.appendChild(q),a.appendChild(t),a.style.visibility="hidden",D(Aa.container,a),a}function ga(){var a=document.createElement("div");y(a,"ebl-toolbar","ebl-title-toolbar");var b=A("ebl-action-title-tag",eblLang.title_toolbar_tags);return y(b,"fa","fa-tags"),b.onmousedown=function(){var a="",b=Ba.post.tags;o(b)&&(b=[]);for(var c=0;c<b.length;++c)a+=b[c].id,c<b.length-1&&(a+=", ");_(a,function(a){Ba.post.tags=v(a)})},a.appendChild(b),a.style.visibility="hidden",D(Aa.container,a),a}function ha(){return la()?void u(a,"popstate",function(a){a.state&&a.state.hasOwnProperty("ebl")&&(Ba=a.state.ebl,o(Ba.post)?S():Ba.post.status===za.NEW?R():Q(Ba.post.id,Ba.post.edit))},!1):void i("this browser does not support History API. seamless navigation is disabled.")}function ia(b,c,d,e){if(la()){var f=history.state;o(f)&&(f={}),f.ebl=Ba=b,e?history.replaceState(f,null,d):history.pushState(f,null,d)}else e||(a.location.search=d);e||(wa=!0)}function ja(b){wa&&a.history.back(b)}function ka(a){if(!o(Aa.config.pageTitleFormat)){var b=Aa.originalTitle,c=null;c=o(a)?b:Aa.config.pageTitleFormat.replace(/{original_title}/,b).replace(/{ebl_title}/,a.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; "));try{document.getElementsByTagName("title")[0].innerHTML=c}catch(d){}document.title=c}}function la(){return!(!a.history||!history.pushState)}var ma=a.Ebl={};ma.version="0.0.1";var na=!0,oa=document.getElementsByTagName("script"),pa=oa[oa.length-1].src.split("?")[0].split("/").slice(0,-1).join("/");a.getComputedStyle||(a.getComputedStyle=function(a,b){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e-1,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),ma.init=function(a,b){d(a,b)},ma.showLogin=function(){X()},ma.openPreviews=function(){e()},ma.openPost=function(a){f(a,!1)},ma.createNew=function(){g()};var qa=function(){};qa.extend=function(a,b){var c=qa.prototype.extend;qa._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete qa._prototyping;var e=d.constructor,f=d.constructor=function(){if(!qa._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},qa.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||qa.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=qa.toString}this[a]=b}else if(a){var e=qa.prototype.extend;qa._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=qa._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},qa=qa.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,c,d){for(var e in a)this.prototype[e]===b&&c.call(d,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var ra={DATA:"data",RENDER:"render"},sa={EBL_SUCCESS:200,EBL_ERROR_BADREQUEST:400,EBL_ERROR_AUTH_NOTLOGGED:401,EBL_ERROR_AUTH_SHORTACCESS:429,EBL_ERROR_AUTH_NOADMIN:450,EBL_ERROR_AUTH_ALREADYADMIN:451,EBL_ERROR_AUTH_TOOMANYADMINS:452,EBL_ERROR_INTERNAL:500,EBL_ERROR_DB_ACCESS:550,EBL_ERROR_DB_INSERT:551,EBL_ERROR_DB_SELECT:552,EBL_ERROR_DB_UPDATE:553},ta=0;document.createElement("ebl-template"),document.createElement("header"),document.createElement("time"),document.createElement("nav"),document.createElement("article");var ua={FATAL:0,ERROR:1,SUCCESS:2},va={CREATE_NEW:0,EDIT_CURRENT:1,SAVE_CHANGES:2},wa=!1,xa=qa.extend({constructor:function(){this.isAdmin=!1,this.authToken=null,this.originalTitle=null,this.container=null,this.config={template:"default",language:"en",postsPerPage:5,pageTitleFormat:"{original_title} | {ebl_title}",onBlogLoaded:null,onPostOpened:null,onPageChanged:null}}}),ya=qa.extend({constructor:function(){this.page=0,this.post=null,this.editors=null}}),za={NEW:0,DRAFT:1,PUBLISHED:2,parse:function(a){return"new"==a.toLowerCase()?0:"draft"==a.toLowerCase()?1:"published"==a.toLowerCase()?2:null}},Aa=new xa,Ba=new ya}(window);
//# sourceMappingURL=Ebl.min.js.map