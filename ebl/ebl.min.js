/*! Ebl - v0.0.1 (2015-09-18) */
!function(a,b){"use strict";function c(){var b=Aa.container=document.querySelector(".ebl-container");if(!o(b)){Aa.originalTitle=document.title;var c=b.querySelector("ebl-template"),d=J(c,"eblType");if("page"==d){var e=parseInt(J(c,"eblPageNum"),10);Ba.page=isNaN(e)?0:e}else if("post"==d){var f={};if(f.status=za.parse(J(c,"eblPostStatus")),f.status!=za.NEW){f.id=J(c,"eblPostId"),f.title=J(c,"eblPostTitle"),f.tags=w(J(c,"eblPostTags"));var g=k(location.search,"ebl-edit");null!==g&&1==parseInt(g,10)&&(f.edit=!0),la(f.title)}else f.edit=!0;Ba.post=f}var h=[];h.push({url:qa+"/languages/"+Aa.config.language+".js",type:"js"}),h.push({url:qa+"/css/base.css",type:"css"}),h.push({url:qa+"/css/font-awesome/css/font-awesome.min.css",type:"css"}),u()||t()||(h.push({url:qa+"/libs/alertify/alertify.min.js",type:"js"}),h.push({url:qa+"/libs/alertify/css/alertify.min.css",type:"css"}),h.push({url:qa+"/libs/alertify/css/themes/default.min.css",type:"css"})),M(h,function(){ja(Ba,null,null,!0),ia(),ea();var b=Aa.container;D(b),U(b),V(b),x(sa.DATA,"action=get_session","GET",!0,null,function(b){Aa.isAdmin=b.data.attributes.logged,Aa.isAdmin===!0&&(Aa.authToken=b.data.attributes.token),W(),!o(Ba.post)&&Ba.post.edit&&N(),"#ebl-login"==a.location.hash&&Y()},function(a,b){if(Aa.isAdmin=!1,Aa.authToken=null,W(),a===ta.EBL_ERROR_AUTH_NOADMIN)X();else{var c=a===ta.EBL_ERROR_DB_ACCESS?"There is a problem connecting to the DB: "+b.message:"General error: "+b.message;da(va.FATAL,c)}}),v(a,"beforeunload",function(a){return o(Ba.editors)?void 0:eblLang.editor_closeWarning}),v(a,"hashchange",function(b){"#ebl-login"==a.location.hash&&Y()});var c=Aa.config.onBlogLoaded;"function"==typeof c&&c()})}}function d(a,b){var d=null;if(L(a)?d=a:"string"==typeof a&&(d=document.getElementById(a)),o(d))return void j("can't create Ebl on invalid element");if(!o(b))for(var e in b)b.hasOwnProperty(e)&&(Aa.config[e]=b[e]);var f,g,h,i="",l=!1;null!==(f=k(location.search,"ebl-post"))&&(i+="&ebl-post="+f,l=!0),l||null===(g=k(location.search,"ebl-page"))||(i+="&ebl-page="+parseInt(g,10),l=!0),l||null===(h=k(location.search,"ebl-new"))||1!=parseInt(h,10)||(i+="&ebl-new=1",l=!0),x(sa.RENDER,"action=get_html"+i+n(Aa.config,"template","postsPerPage"),"GET",!1,null,function(a){d.insertAdjacentHTML("beforeend",a),c()},function(a,b){d.insertAdjacentHTML("beforeend",b)})}function e(b){var c=new ya;c.page=b?b:0;var d=l(a.location.search,"ebl-page",c.page);d=m(d,"ebl-post"),d=m(d,"ebl-edit"),d=m(d,"ebl-new"),ja(c,null,d),T()}function f(b,c){var d=new ya;d.post={id:b};var e=l(a.location.search,"ebl-post",d.post.id);e=m(e,"ebl-edit"),e=m(e,"ebl-page"),e=m(e,"ebl-new"),ja(d,null,e,c),R(d.post.id)}function g(){if(!Aa.isAdmin)return void j("can't open editor, admin not logged");var b={};b.post={edit:!0,status:za.NEW};var c=l(a.location.search,"ebl-new","1");c=m(c,"ebl-post"),c=m(c,"ebl-edit"),c=m(c,"ebl-page"),ja(b,null,c),S()}function h(a){oa&&console.log("[Ebl v"+na.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function i(a){console.warn("[Ebl v"+na.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function j(a){console.error("[Ebl v"+na.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function k(a,b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a)||[,""])[1].replace(/\+/g,"%20"))||null}function l(a,b,c){if(a.indexOf(b+"=")>=0){var d=a.substring(0,a.indexOf(b)),e=a.substring(a.indexOf(b));e=e.substring(e.indexOf("=")+1),e=e.indexOf("&")>=0?e.substring(e.indexOf("&")):"",a=d+b+"="+c+e}else a+=a.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;return a}function m(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-->0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);a=c[0]+"?"+e.join("&")}return-1!==a.indexOf("?",a.length-1)&&a.slice(0,-1),a}function n(a){function b(a){return"_"+a.toLowerCase()}for(var c="",d=[],e=1;e<arguments.length;++e)d.push(arguments[e]);for(var f in a)if(!(d.length>0&&-1==d.indexOf(f))){var g=a[f];if(!o(g)&&"function"!=typeof g){"boolean"==typeof g&&(g=g?1:0);var h=f.replace(/([A-Z])/g,b);c+="&"+h+"="+g}}return c}function o(a){return"undefined"==typeof a||null===a}function p(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(a,c){a[c]=b;try{delete a[c]}catch(d){}}function r(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function t(){for(var a=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0];);if(4>=a){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/);a=e?parseInt(e[1]):b}return 9>a}function u(){return!("undefined"==typeof alertify)}function v(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c)}function w(a){for(var b=[],c=a.split(","),d=0;d<c.length;++d)b.push({id:c[d]});return b}function x(b,c,d,e,f,g,i){h("sending request... params: "+c+" | type: "+b+" | method: "+d+" | async: "+e);var k=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){if(k.readyState<4)"function"==typeof f&&f();else if(4==k.readyState){k.onreadystatechange=null;var a=k.responseText;if(200==k.status)h("response from "+b+" API: "+a),"function"==typeof g&&g(b==sa.RENDER?a:JSON.parse(a));else{var c=null;c=b==sa.RENDER?a:JSON.parse(a).errors[0].message,j("error "+k.status+" from "+b+" API: "+c),"function"==typeof i&&i(k.status,c)}}};try{"GET"==d?(k.open(d,qa+"/api/"+b+".php?"+c,e),k.send(null)):"POST"==d&&(k.open(d,qa+"/api/"+b+".php",e),k.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),k.send(c))}catch(l){j("error connecting to Ebl API: "+l)}}function y(a,b){return null!==a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function z(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];y(a,c)||(a.className.length>0&&(a.className+=" "),a.className+=c)}}function A(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(y(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d," "),a.className=a.className.trim()}}}function B(a,b){var c=document.createElement("button");return z(c,"ebl-button"),a&&z(c,a),b&&(c.title=b),c}function C(a,b){var c=document.createElement("span");return K(c,"tooltip",b),c.appendChild(a),c}function D(a){for(var b=a.getElementsByTagName("script"),c=0;c<b.length;c++){var d=document.createElement("script");d.innerHTML=b[c].innerHTML,b[c].parentNode.appendChild(d),b[c].parentNode.removeChild(b[c])}}function E(a,b){a.insertBefore(b,a.childNodes[0])}function F(a){o(a)||(o(a.origDisplay)?a.style.display="inline-block":a.style.display=a.origDisplay)}function G(a){o(a)||(y(a,"ebl-toolbar")?a.style.visibility="hidden":(o(a.origDisplay)&&(a.origDisplay=a.currentStyle?a.currentStyle.display:getComputedStyle(a,null).display),a.style.display="none"))}function H(a){o(a)||a.parentNode.removeChild(a)}function I(a,b,c,d,e,f,g,i){h("animating with values: "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g);var j=(new Date).getTime(),k=setInterval(function(){var h=Math.min(1,((new Date).getTime()-j)/g);d?a[b]=e+l(h)*(f-e)+c:a.style[b]=e+l(h)*(f-e)+c,1==h&&(clearInterval(k),"function"==typeof i&&i())},10);d?a[b]=e+c:a.style[b]=e+c;var l=function(a){return.5>a?2*a*a:-1+(4-2*a)*a}}function J(a,b){return a.dataset?a.dataset[b]:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.getAttribute("data-"+b))}function K(a,b,c){a.dataset?a.dataset[b]=c:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.setAttribute("data-"+b,c))}function L(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function M(a,b){function c(a){h(a+" loaded"),++e==f&&b()}function d(a,b,c){var d;"css"===b?(d=document.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=a,"function"==typeof c&&c(a)):"js"===b&&(d=document.createElement("script"),d.type="text/javascript",d.readyState?d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,"function"==typeof c&&c(a))}:(d.onload=function(){"function"==typeof c&&c(a)},d.onerror=function(){j("error loading "+a)}),d.src=a),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)}var e=0,f=a.length;if(0===f)return void b();for(var g=0;f>g;)d(a[g].url,a[g].type,c),g++}function N(){if(!Aa.isAdmin)return void j("can't open editor, admin not logged");if("undefined"==typeof wysihtml5){if(ua>=1)return void j("error loading editor library.");ua++,h("editor library not yet loaded. perform loading now...");var a=[];return a.push({url:qa+"/libs/wysihtml/wysihtml-toolbar.min.js",type:"js"}),void M(a,function(){a=[],a.push({url:qa+"/libs/wysihtml/parser_rules/advanced_and_extended.js",type:"js"}),M(a,function(){N()})})}O()}function O(){function b(b,d){if(!o(b)&&o(Ba.editors))return(b.target||b.srcElement).removeEventListener("click",this),!1;var e=null,f=null,g=document.documentElement,h=Math.max(g.clientWidth,a.innerWidth||0);if(s()||d){var i=l.getBoundingClientRect();e=i.left+(l.offsetWidth/2-m.offsetWidth/2),f=i.top-m.offsetHeight-5}else{var j=null,k=null;if(document.selection&&document.selection.createRange)k=document.selection.createRange(),j={top:k.offsetTop,left:k.offsetLeft};else if(a.getSelection&&a.getSelection().rangeCount>0){k=a.getSelection().getRangeAt(0).cloneRange();var n=k.getBoundingClientRect();j={top:n.top,left:n.left}}if(!o(j)){var p=m.offsetWidth/2;e=j.left-p+5,5>e?e=5:e>h-p-5&&(e=h-p-5),f=j.top-m.offsetHeight-20}}if(null!==e||null!==f){var q=(a.pageXOffset||g.scrollLeft)-(g.clientLeft||0),r=(a.pageYOffset||g.scrollTop)-(g.clientTop||0);e+=q,f+=r;var t=!0,u=parseInt(m.style.left,10);isNaN(u)&&(t=!1);var v=parseInt(m.style.top,10);return isNaN(v)&&(t=!1),m.style.visibility="visible",t?(I(m,"left","px",!1,Math.ceil(u),Math.ceil(e),300),I(m,"top","px",!1,Math.ceil(v),Math.ceil(f),300)):(m.style.left=Math.ceil(e)+"px",m.style.top=Math.ceil(f)+"px"),!0}return c(),!1}function c(){y(m,"ebl-sticky")||G(m)}function d(a){for(var c="textarea"===a,d=m.querySelectorAll(".ebl-button, .ebl-separator"),e=0;e<d.length;e++)c?G(d[e]):F(d[e]);var f=m.querySelector(".ebl-action-editor-html");c?(A(f,"fa-file-code-o"),z(f,"fa-file-text-o","fa-2x"),f.title=eblLang.editor_toolbar_closeHTML,F(f),z(m,"ebl-sticky")):(A(f,"fa-file-text-o","fa-2x"),z(f,"fa-file-code-o"),f.title=eblLang.editor_toolbar_editHTML,A(m,"ebl-sticky")),b({},!0)}function e(){var b=Ba.editors.title,c=b.getBoundingClientRect(),d=c.left+(b.offsetWidth/2-k.offsetWidth/2),e=c.top-k.offsetHeight-5,f=document.documentElement,g=(a.pageXOffset||f.scrollLeft)-(f.clientLeft||0),h=(a.pageYOffset||f.scrollTop)-(f.clientTop||0);return d+=g,e+=h,k.style.left=Math.ceil(d)+"px",k.style.top=Math.ceil(e)+"px",k.style.visibility="visible",!0}function f(){G(k)}function g(a){var b=a.keyCode||a.which;return 13==b?(a.preventDefault(),!1):void 0}var h={},i=Aa.container.querySelector(Ba.post.status===za.NEW?".ebl-post-new":".ebl-post-singleview#ebl-post_"+Ba.post.id),j=i.querySelector(".ebl-post-title");z(j,"ebl-editable"),j.contentEditable=!0,Ba.post.status===za.NEW?j.innerHTML=eblLang.editor_placeholder_title:j.oldValue=j.innerHTML;var k=Aa.container.querySelector(".ebl-title-toolbar");o(k)&&(k=ha()),h.title=j,v(h.title,"keypress",g),v(h.title,"focus",e),v(h.title,"blur",f);var l=i.querySelector(".ebl-post-body");z(l,"ebl-editable"),l.oldValue=l.innerHTML;var m=Aa.container.querySelector(".ebl-editor-toolbar");if(o(m)&&(m=ga()),h.content=new wysihtml5.Editor(l,{name:"ebl-editor-body",style:!1,showToolbarAfterInit:!1,parserRules:wysihtml5ParserRules,uneditableContainerClassname:!1,useLineBreaks:!1,toolbar:m}),Ba.post.status===za.NEW&&h.content.setValue("<p>"+eblLang.editor_placeholder_content+"</p>"),h.content.on("newword:composer",b),h.content.on("show:dialog",function(){z(m,"ebl-sticky")}),h.content.on("cancel:dialog",function(){A(m,"ebl-sticky")}),h.content.on("blur",c),h.content.on("change_view",d),v(l,"click",b),Ba.editors=h,Ba.post.status===za.NEW)for(var n=i.querySelectorAll(".ebl-comments"),p=0;p<n.length;++p)H(n[p])}function P(a){if(G(Aa.container.querySelector(".ebl-editor-toolbar")),!o(Ba.editors)){var b=Ba.editors.title,c=Ba.editors.content;b.blur(),b.contentEditable=!1,A(b,"ebl-editable"),a&&!o(b.oldValue)&&(b.innerHTML=b.oldValue),q(b,"oldValue"),c.destroy(),A(c.editableElement,"ebl-editable"),Ba.editors=null}}function Q(a){if(o(Ba.editors))return void j("there is no active editor.");var b=Ba.editors.title;b.oldValue=b.innerHTML;var c=encodeURIComponent(r((b.textContent||b.innerText).trim()));if(0===c.length)return void da(va.ERROR,eblLang.editor_missingTitle);var d=Ba.editors.content;"source"==d.currentView&&d.fire("change_view","composer");var e=encodeURIComponent(d.getValue()),g=d.editableElement;g.oldValue=g.innerHTML,o(Ba.post.tags)&&(Ba.post.tags=[]);var h=JSON.stringify(Ba.post.tags),i=Ba.post.status===za.NEW,k=i?"action=publish_post&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0):"action=update_post&id="+Ba.post.id+"&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0);k+="&token="+Aa.authToken,x(sa.DATA,k,"POST",!0,function(){ba()},function(b){ca();var c=b.meta.id;Ba.post.id=c,Ba.post.status=a?za.DRAFT:za.PUBLISHED,a||(P(),f(c,i)),a?da(va.SUCCESS,eblLang.editor_saved):i?da(va.SUCCESS,eblLang.editor_published):da(va.SUCCESS,eblLang.editor_updated)},function(a,b){ca(),da(va.FATAL,"I can't publish this document: "+r(b))})}function R(a,b){P(),x(sa.RENDER,"action=get_post&id="+a+n(Aa.config,"template"),"GET",!0,function(){ba()},function(c){ca();var d=Aa.container;H(d.querySelector("ebl-template")),d.insertAdjacentHTML("beforeend",c);var e=d.querySelector("ebl-template"),f=Ba.post;f.id=J(e,"eblPostId"),f.status=za.parse(J(e,"eblPostStatus")),f.title=J(e,"eblPostTitle"),f.tags=[];for(var g=J(e,"eblPostTags").split(","),h=0;h<g.length;++h)f.tags.push({id:g[h]});D(e),U(e),V(e),la(f.title),b===!0&&N(),fa();var i=Aa.config.onPostOpened;"function"==typeof i&&i(a)},function(a,b){ca();var c=Aa.container;H(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function S(){x(sa.RENDER,"action=get_html&ebl-new=1"+n(Aa.config,"template"),"GET",!0,function(){ba()},function(a){ca();var b=Aa.container;H(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template"),d=Ba.post;d.status=za.NEW;for(var e=c.querySelectorAll(".ebl-comments"),f=0;f<e.length;++f)H(e[f]);D(c),U(c),V(c),la(eblLang.editor_placeholder_title),N(),fa()},function(a,b){ca();var c=Aa.container;H(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function T(){P(),x(sa.RENDER,"action=get_page&number="+Ba.page+n(Aa.config,"template","postsPerPage"),"GET",!0,function(){ba()},function(a){ca();var b=Aa.container;H(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template");Ba.page=parseInt(J(c,"eblPageNum"),0),q(Ba,"post"),D(c),U(c),V(c),la(null),fa();var d=Aa.config.onPageChanged;"function"==typeof d&&d(Ba.page)},function(a,b){ca();var c=Aa.container;H(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function U(b){for(var c=b.querySelectorAll(".ebl-post-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d=document.documentElement||document.body;I(d,"scrollTop","",!0,d.scrollTop,Aa.container.offsetTop-40,400,function(){f(c.substring(c.lastIndexOf("?ebl-post=")+"?ebl-post=".length),!1)})}:i("found a post link but it's not an <a> tag! seamless navigation is disabled.")}}function V(b){for(var c=b.querySelectorAll(".ebl-nav-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d={};d.page=parseInt(c.substring(c.lastIndexOf("?ebl-page=")+"?ebl-page=".length),10);var e=l(a.location.search,"ebl-page",d.page);e=m(e,"ebl-post");var f=document.documentElement||document.body;I(f,"scrollTop","",!0,f.scrollTop,Aa.container.offsetTop-40,400,function(){ja(d,null,e),T()})}:i("found a nav link but it's not an <a> tag! seamless navigation is disabled for it.")}}function W(){var a=Aa.container.querySelector(".ebl-adminbar");Aa.isAdmin?(fa(),F(a)):(P(),G(a))}function X(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&da(va.ERROR,eblLang.init_shortPassword)):void x(sa.DATA,"action=init_repository&psw="+a,"POST",!0,null,function(a){c&&c.close(),Aa.isAdmin=!0,Aa.authToken=a.data.attributes.token,da(va.SUCCESS,eblLang.init_ok),W()},function(a,b){da(va.FATAL,"can't initialize database: "+b)})}if(Aa.isAdmin)return void j("can't show dialog, admin already exists and it's logged.");if(u()){var b=alertify.prompt(),c=b.elements.footer.querySelector("button.ajs-cancel");G(c),b.set({title:eblLang.init_title,message:eblLang.init_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var d=prompt(eblLang.init_message,"");d&&a(d)}}function Y(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&da(va.ERROR,eblLang.login_badPassword)):void x(sa.DATA,"action=log_in&psw="+a,"POST",!0,null,function(a){Aa.isAdmin=!0,Aa.authToken=a.data.attributes.token,da(va.SUCCESS,eblLang.login_ok),c&&c.close(),W(),o(Ba.post)&&e()},function(a,b){if(a===ta.EBL_ERROR_AUTH_SHORTACCESS);else if(a===ta.EBL_ERROR_AUTH_NOTLOGGED)da(va.ERROR,eblLang.login_badPassword);else{var d="login error: "+b;c&&c.close(),da(va.FATAL,d),j(b)}})}if(Aa.isAdmin)return void i("already logged in.");if(u()){var b=alertify.prompt();b.set({title:eblLang.login_title,message:eblLang.login_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var c=prompt(eblLang.login_message,"");c&&a(c)}}function Z(){function a(){x(sa.DATA,"action=log_out","POST",!0,function(){ba()},function(a){if(ca(),Aa.isAdmin=!1,Aa.authToken=null,W(),o(Ba.post))e();else{var b=Aa.container.querySelector(".ebl-post-singleview#ebl-post_"+Ba.post.id);y(b,"ebl-draft")&&e()}},function(a,b){ca(),da(va.FATAL,b)})}if(!Aa.isAdmin)return void j("can't show dialog, user already logged out.");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.logout_message,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.logout_message);c&&a()}}function $(a){function b(){x(sa.DATA,"action=delete_post&id="+a+"&token="+Aa.authToken,"POST",!0,function(){ba()},function(a){ca(),da(va.SUCCESS,eblLang.deletepost_ok),q(Ba.post),T()},function(a,b){ca(),da(va.FATAL,"error while deleting: "+b)})}if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.confirm();c.set({title:"",message:eblLang.deletepost_confirm,modal:!0,movable:!1,onok:b}),c.show()}else{var d=confirm(eblLang.deletepost_confirm);d&&b()}}function _(a){if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.redraft_confirm,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.redraft_confirm);c&&a()}}function aa(a,b){if(!Aa.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.prompt(),d=c.elements.body.querySelector("input.ajs-input");d.placeholder=eblLang.tags_placeholder,c.set({title:eblLang.tags_title,message:eblLang.tags_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,type:"text",labels:{ok:eblLang.general_ok},value:a,onok:function(a,c){b(c)}}),c.show()}else{var e=prompt(eblLang.tags_message);e&&b(e)}}function ba(){var a=Aa.container,b=a.querySelector(".ebl-loading-overlay");if(o(b)){b=document.createElement("div"),z(b,"ebl-loading-overlay","ebl-unselectable");var c=document.createElement("div");z(c,"fa","fa-cog","fa-spin","fa-4x"),b.appendChild(c),E(a,b)}a.style.position="relative",z(b,"visible")}function ca(){var a=Aa.container,b=a.querySelector(".ebl-loading-overlay");a.style.position="static",A(b,"visible")}function da(a,b){a==va.SUCCESS?u()?alertify.success(b):alert(b):a==va.ERROR?u()?alertify.error(b):alert(b):a==va.FATAL&&(u()?alertify.alert("",'<p class="ebl-error">'+eblLang.general_fatalError+'</p><pre class="ebl-pre">'+b+"</pre>"):alert(b))}function ea(){var b=document.createElement("div");z(b,"ebl-adminbar","ebl-unselectable"),b.origDisplay="block",b.style.display="none";var c=document.createElement("div");z(c,"ebl-adminbar-new");var d=B("ebl-action-new");z(d,"fa","fa-2x","fa-plus-square-o"),d.onclick=function(){g()},c.appendChild(C(d,eblLang.button_addNew));var e=document.createElement("div");z(e,"ebl-adminbar-edit");var f=B("ebl-action-edit");z(f,"fa","fa-2x","fa-pencil-square-o"),f.onclick=function(){var b=p(Ba);b.post.edit=!0;var c=l(a.location.search,"ebl-edit","1");ja(b,null,c),N(),fa()};var h=B("ebl-action-delete");z(h,"fa","fa-2x","fa-trash-o"),h.onclick=function(){$(Ba.post.id)},e.appendChild(C(f,eblLang.button_editPost)),e.appendChild(C(h,eblLang.button_deletePost));var i=document.createElement("div");z(i,"ebl-adminbar-publish");var j=B("ebl-action-save");z(j,"fa","fa-2x","fa-floppy-o"),j.onclick=function(){Ba.post.status==za.PUBLISHED?_(function(){Q(!0)}):Q(!0)};var k=B("ebl-action-publish");z(k,"fa","fa-2x","fa-cloud-upload"),k.onclick=function(){Q(!1)};var m=B("ebl-action-cancel");z(m,"fa","fa-2x","fa-times"),m.onclick=function(){P(!0),ka()},i.appendChild(C(j,eblLang.button_saveDraft)),i.appendChild(C(k,eblLang.button_publishPost)),i.appendChild(C(m,eblLang.general_cancel));var n=B("ebl-action-logout");z(n,"fa","fa-2x","fa-sign-out"),n.onclick=function(){Z()},b.appendChild(c),b.appendChild(e),b.appendChild(i),b.appendChild(n),E(Aa.container,b),fa()}function fa(){var a=Aa.container,b=a.querySelector(".ebl-adminbar-new"),c=a.querySelector(".ebl-adminbar-publish"),d=a.querySelector(".ebl-adminbar-edit");o(Ba.post)?(F(b),G(c),G(d)):Ba.post.edit===!0?(G(b),F(c),G(d)):(G(b),G(c),F(d))}function ga(){var a=document.createElement("div");z(a,"ebl-toolbar","ebl-editor-toolbar");var b=document.createElement("span");z(b,"ebl-separator");var c=document.createElement("div"),d=B("ebl-action-editor-undo",eblLang.editor_toolbar_undo);z(d,"fa","fa-undo"),K(d,"wysihtml5Command","undo");var e=B("ebl-action-editor-bold",eblLang.editor_toolbar_textBold);z(e,"fa","fa-bold"),K(e,"wysihtml5Command","bold");var f=B("ebl-action-editor-italic",eblLang.editor_toolbar_textItalic);z(f,"fa","fa-italic"),K(f,"wysihtml5Command","italic");var g=B("ebl-action-editor-underline",eblLang.editor_toolbar_textUnderline);z(g,"fa","fa-underline"),K(g,"wysihtml5Command","underline");var h=B("ebl-action-editor-h1",eblLang.editor_toolbar_textH1);z(h,"fa","fa-header"),K(h,"wysihtml5Command","formatBlock"),K(h,"wysihtml5CommandValue","h1");var i=B("ebl-action-editor-alignleft",eblLang.editor_toolbar_textAlignLeft);z(i,"fa","fa-align-left"),K(i,"wysihtml5Command","justifyLeft");var j=B("ebl-action-editor-aligncenter",eblLang.editor_toolbar_textAlignCenter);z(j,"fa","fa-align-center"),K(j,"wysihtml5Command","justifyCenter");var k=B("ebl-action-editor-alignright",eblLang.editor_toolbar_textAlignRight);z(k,"fa","fa-align-right"),K(k,"wysihtml5Command","justifyRight");var l=B("ebl-action-editor-addul",eblLang.editor_toolbar_addUl);z(l,"fa","fa-list-ul"),K(l,"wysihtml5Command","insertUnorderedList");var m=B("ebl-action-editor-addol",eblLang.editor_toolbar_addOl);z(m,"fa","fa-list-ol"),K(m,"wysihtml5Command","insertOrderedList");var n=B("ebl-action-editor-addimage",eblLang.editor_toolbar_addImage);z(n,"fa","fa-picture-o"),K(n,"wysihtml5Command","insertImage");var o=B("ebl-action-editor-addlink",eblLang.editor_toolbar_addLink);z(o,"fa","fa-link"),K(o,"wysihtml5Command","createLink");var p=B("ebl-action-editor-html",eblLang.editor_toolbar_editHTML);z(p,"fa","fa-file-code-o"),K(p,"wysihtml5Action","change_view"),c.appendChild(d),c.appendChild(b.cloneNode(!0)),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(b.cloneNode(!0)),c.appendChild(i),c.appendChild(j),c.appendChild(k),c.appendChild(b.cloneNode(!0)),c.appendChild(l),c.appendChild(m),c.appendChild(b.cloneNode(!0)),c.appendChild(n),c.appendChild(o),c.appendChild(b.cloneNode(!0)),c.appendChild(p);var q=document.createElement("div");K(q,"wysihtml5Dialog","insertImage"),z(q,"ebl-editor-toolbar-sub","toolbar-sub-2");var r=document.createElement("input");K(r,"wysihtml5DialogField","src"),r.type="text",r.value="http://";var s=B("ebl-action-editor-image-save",eblLang.editor_toolbar_addImage);s.innerHTML=eblLang.editor_toolbar_addImage,K(s,"wysihtml5DialogAction","save"),q.appendChild(r),q.appendChild(s),G(q);var t=document.createElement("div");K(t,"wysihtml5Dialog","createLink"),z(t,"ebl-editor-toolbar-sub","toolbar-sub-2");var u=document.createElement("input");K(u,"wysihtml5DialogField","href"),u.type="text",u.value="http://";var v=B("ebl-action-editor-link-save",eblLang.editor_toolbar_addLink);return v.innerHTML=eblLang.editor_toolbar_addLink,K(v,"wysihtml5DialogAction","save"),t.appendChild(u),t.appendChild(v),G(t),a.appendChild(c),a.appendChild(q),a.appendChild(t),a.style.visibility="hidden",E(Aa.container,a),a}function ha(){var a=document.createElement("div");z(a,"ebl-toolbar","ebl-title-toolbar");var b=B("ebl-action-title-tag",eblLang.title_toolbar_tags);return z(b,"fa","fa-tags"),b.onmousedown=function(){var a="",b=Ba.post.tags;o(b)&&(b=[]);for(var c=0;c<b.length;++c)a+=b[c].id,c<b.length-1&&(a+=", ");aa(a,function(a){Ba.post.tags=w(a)})},a.appendChild(b),a.style.visibility="hidden",E(Aa.container,a),a}function ia(){return ma()?void v(a,"popstate",function(a){a.state&&a.state.hasOwnProperty("ebl")&&(Ba=a.state.ebl,o(Ba.post)?T():Ba.post.status===za.NEW?S():R(Ba.post.id,Ba.post.edit))},!1):void i("this browser does not support History API. seamless navigation is disabled.")}function ja(b,c,d,e){if(ma()){var f=history.state;o(f)&&(f={}),f.ebl=Ba=b,e?history.replaceState(f,null,d):history.pushState(f,null,d)}else e||(a.location.search=d);e||(wa=!0)}function ka(b){wa?a.history.back(b):T()}function la(a){if(!o(Aa.config.pageTitleFormat)){var b=Aa.originalTitle,c=null;c=o(a)?b:Aa.config.pageTitleFormat.replace(/{original_title}/,b).replace(/{ebl_title}/,r(a));try{document.getElementsByTagName("title")[0].innerHTML=c}catch(d){}document.title=c}}function ma(){return!(!a.history||!history.pushState)}var na=a.Ebl={};na.version="0.0.1";var oa=!0,pa=document.getElementsByTagName("script"),qa=pa[pa.length-1].src.split("?")[0].split("/").slice(0,-1).join("/");a.getComputedStyle||(a.getComputedStyle=function(a,b){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e-1,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),na.init=function(a,b){d(a,b)},na.showLogin=function(){Y()},na.openPreviews=function(){e()},na.openPost=function(a){f(a,!1)},na.createNew=function(){g()};var ra=function(){};ra.extend=function(a,b){var c=ra.prototype.extend;ra._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete ra._prototyping;var e=d.constructor,f=d.constructor=function(){if(!ra._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},ra.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||ra.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=ra.toString}this[a]=b}else if(a){var e=ra.prototype.extend;ra._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=ra._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},ra=ra.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,c,d){for(var e in a)this.prototype[e]===b&&c.call(d,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var sa={DATA:"data",RENDER:"render"},ta={EBL_SUCCESS:200,EBL_ERROR_BADREQUEST:400,EBL_ERROR_AUTH_NOTLOGGED:401,EBL_ERROR_NOTFOUND:404,EBL_ERROR_AUTH_SHORTACCESS:429,EBL_ERROR_AUTH_NOADMIN:450,EBL_ERROR_AUTH_ALREADYADMIN:451,EBL_ERROR_AUTH_TOOMANYADMINS:452,EBL_ERROR_INTERNAL:500,EBL_ERROR_DB_ACCESS:550,EBL_ERROR_DB_INSERT:551,EBL_ERROR_DB_UPDATE:552},ua=0;document.createElement("ebl-template"),document.createElement("header"),document.createElement("time"),document.createElement("nav"),document.createElement("article");var va={FATAL:0,ERROR:1,SUCCESS:2},wa=!1,xa=ra.extend({constructor:function(){this.isAdmin=!1,this.authToken=null,this.originalTitle=null,this.container=null,this.config={template:"default",language:"en",postsPerPage:5,pageTitleFormat:"{original_title} | {ebl_title}",onBlogLoaded:null,onPostOpened:null,onPageChanged:null}}}),ya=ra.extend({constructor:function(){this.page=0,this.post=null,this.editors=null}}),za={NEW:0,DRAFT:1,PUBLISHED:2,parse:function(a){return"new"==a.toLowerCase()?0:"draft"==a.toLowerCase()?1:"published"==a.toLowerCase()?2:null}},Aa=new xa,Ba=new ya}(window);