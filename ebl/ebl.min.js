/*! Ebl - v0.0.1 (2016-01-31) */
!function(a,b){"use strict";function c(){var b=Ca.container=document.querySelector(".ebl-container");if(!o(b)){Ca.originalTitle=document.title;var c=b.querySelector("ebl-template"),d=L(c,"eblType");if("page"==d){var e=parseInt(L(c,"eblPageNum"),10);Da.page=isNaN(e)?0:e}else if("post"==d){var f={};if(f.status=Ba.parse(L(c,"eblPostStatus")),f.status!=Ba.NEW){f.id=L(c,"eblPostId"),f.title=L(c,"eblPostTitle"),f.createdAt=y(L(c,"eblPostCreatedat")),f.updatedAt=y(L(c,"eblPostUpdatedat")),f.tags=w(L(c,"eblPostTags"));var g=k(location.search,"ebl-edit");null!==g&&1==parseInt(g,10)&&(f.edit=!0),na(f.title)}else f.edit=!0;Da.post=f}var h=[];h.push({url:sa+"/languages/"+Ca.config.language+".js",type:"js"}),h.push({url:sa+"/css/base.css",type:"css"}),u()||t()||(h.push({url:sa+"/libs/alertify/alertify.min.js",type:"js"}),h.push({url:sa+"/libs/alertify/css/alertify.min.css",type:"css"}),h.push({url:sa+"/libs/alertify/css/themes/default.min.css",type:"css"})),O(h,function(){la(Da,null,null,!0),ka(),ga();var b=Ca.container;F(b),W(b),X(b),z(ua.DATA,"action=get_session","GET",!0,null,function(b){Ca.isAdmin=b.data.attributes.logged,Ca.isAdmin===!0&&(Ca.authToken=b.data.attributes.token),Y(),!o(Da.post)&&Da.post.edit&&P(),"#ebl-login"==a.location.hash&&$()},function(a,b){if(Ca.isAdmin=!1,Ca.authToken=null,Y(),a===va.EBL_ERROR_AUTH_NOADMIN)Z();else{var c=a===va.EBL_ERROR_DB_ACCESS?"There is a problem connecting to the DB: "+b.message:"General error: "+b.message;fa(xa.FATAL,c)}}),v(a,"beforeunload",function(a){return o(Da.editors)?void 0:(a.returnValue=eblLang.editor_closeWarning,eblLang.editor_closeWarning)}),v(a,"hashchange",function(b){"#ebl-login"==a.location.hash&&$()});var c=Ca.config.onBlogLoaded;"function"==typeof c&&c()})}}function d(a,b){var d=null;if(N(a)?d=a:"string"==typeof a&&(d=document.getElementById(a)),o(d))return void j("can't create Ebl on invalid element");if(!o(b))for(var e in b)b.hasOwnProperty(e)&&(Ca.config[e]=b[e]);var f,g,h,i="",l=!1;null!==(f=k(location.search,"ebl-post"))&&(i+="&ebl-post="+f,l=!0),l||null===(g=k(location.search,"ebl-page"))||(i+="&ebl-page="+parseInt(g,10),l=!0),l||null===(h=k(location.search,"ebl-new"))||1!=parseInt(h,10)||(i+="&ebl-new=1",l=!0),z(ua.RENDER,"action=get_html"+i+n(Ca.config,"template","postsPerPage"),"GET",!1,null,function(a){d.insertAdjacentHTML("beforeend",a),c()},function(a,b){d.insertAdjacentHTML("beforeend",b)})}function e(b){var c=new Aa;c.page=b?b:0;var d=l(a.location.search,"ebl-page",c.page);d=m(d,"ebl-post"),d=m(d,"ebl-edit"),d=m(d,"ebl-new"),la(c,null,d),V()}function f(b,c){var d=new Aa;d.post={id:b};var e=l(a.location.search,"ebl-post",d.post.id);e=m(e,"ebl-edit"),e=m(e,"ebl-page"),e=m(e,"ebl-new"),la(d,null,e,c),T(d.post.id)}function g(){if(!Ca.isAdmin)return void j("can't open editor, admin not logged");var b={};b.post={edit:!0,status:Ba.NEW};var c=l(a.location.search,"ebl-new","1");c=m(c,"ebl-post"),c=m(c,"ebl-edit"),c=m(c,"ebl-page"),la(b,null,c),U()}function h(a){qa&&console.log("[Ebl v"+pa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function i(a){console.warn("[Ebl v"+pa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function j(a){console.error("[Ebl v"+pa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function k(a,b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a)||[,""])[1].replace(/\+/g,"%20"))||null}function l(a,b,c){if(a.indexOf(b+"=")>=0){var d=a.substring(0,a.indexOf(b)),e=a.substring(a.indexOf(b));e=e.substring(e.indexOf("=")+1),e=e.indexOf("&")>=0?e.substring(e.indexOf("&")):"",a=d+b+"="+c+e}else a+=a.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;return a}function m(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);a=c[0]+"?"+e.join("&")}return-1!==a.indexOf("?",a.length-1)&&a.slice(0,-1),a}function n(a){function b(a){return"_"+a.toLowerCase()}for(var c="",d=[],e=1;e<arguments.length;++e)d.push(arguments[e]);for(var f in a)if(!(d.length>0&&-1==d.indexOf(f))){var g=a[f];if(!o(g)&&"function"!=typeof g){"boolean"==typeof g&&(g=g?1:0);var h=f.replace(/([A-Z])/g,b);c+="&"+h+"="+g}}return c}function o(a){return"undefined"==typeof a||null===a}function p(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(a,c){a[c]=b;try{delete a[c]}catch(d){}}function r(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function t(){for(var a=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0];);if(4>=a){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/);a=e?parseInt(e[1]):b}return 9>a}function u(){return!("undefined"==typeof alertify)}function v(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c)}function w(a){var b=[];if(o(a))return b;for(var c=a.split(","),d=[],e=0;e<c.length;++e){var f=c[e].trim();f=f.replace(/ +(?= )/g,""),f=f.replace(/ /g,"-"),f=f.toLowerCase();var g={id:f};g.id.length>0&&-1==d.indexOf(g.id)&&(b.push(g),d.push(g.id))}return b}function x(a){var b="";if(o(a))return b;for(var c=0;c<a.length;++c)b+=a[c].id,c<a.length-1&&(b+=", ");return b}function y(a){var b=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?:\:(\d{2}))?/,c=b.exec(a);return new Date(+c[1],+c[2]-1,+c[3],+c[4],+c[5],c[6]?+c[6]:0)}function z(b,c,d,e,f,g,i){h("sending request... params: "+c+" | type: "+b+" | method: "+d+" | async: "+e);var k=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){if(k.readyState<4)"function"==typeof f&&f();else if(4==k.readyState){k.onreadystatechange=null;var a=k.responseText;if(200==k.status)h("response from "+b+" API: "+a),"function"==typeof g&&g(b==ua.RENDER?a:JSON.parse(a));else{var c=null;c=b==ua.RENDER?a:JSON.parse(a).errors[0].message,j("error "+k.status+" from "+b+" API: "+c),"function"==typeof i&&i(k.status,c)}}};try{"GET"==d?(k.open(d,sa+"/api/"+b+".php?"+c,e),k.send(null)):"POST"==d&&(k.open(d,sa+"/api/"+b+".php",e),k.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),k.send(c))}catch(l){j("error connecting to Ebl API: "+l)}}function A(a,b){return null!==a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function B(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];A(a,c)||(a.className.length>0&&(a.className+=" "),a.className+=c)}}function C(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(A(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d," "),a.className=a.className.trim()}}}function D(a,b){var c=document.createElement("button");return B(c,"ebl-button"),a&&B(c,a),b&&(c.title=b),c}function E(a,b){var c=document.createElement("span");return M(c,"tooltip",b),c.appendChild(a),c}function F(a){for(var b=a.getElementsByTagName("script"),c=0;c<b.length;c++){var d=document.createElement("script");d.innerHTML=b[c].innerHTML,b[c].parentNode.appendChild(d),b[c].parentNode.removeChild(b[c])}}function G(a,b){a.insertBefore(b,a.childNodes[0])}function H(a){o(a)||(o(a.origDisplay)?a.style.display="inline-block":a.style.display=a.origDisplay)}function I(a){o(a)||(A(a,"ebl-toolbar")?a.style.visibility="hidden":(o(a.origDisplay)&&(a.origDisplay=a.currentStyle?a.currentStyle.display:getComputedStyle(a,null).display),a.style.display="none"))}function J(a){o(a)||a.parentNode.removeChild(a)}function K(a,b,c,d,e,f,g,i){h("animating with values: "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g);var j=(new Date).getTime(),k=setInterval(function(){var h=Math.min(1,((new Date).getTime()-j)/g);d?a[b]=e+l(h)*(f-e)+c:a.style[b]=e+l(h)*(f-e)+c,1==h&&(clearInterval(k),"function"==typeof i&&i())},10);d?a[b]=e+c:a.style[b]=e+c;var l=function(a){return.5>a?2*a*a:-1+(4-2*a)*a}}function L(a,b){return a.dataset?a.dataset[b]:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.getAttribute("data-"+b))}function M(a,b,c){a.dataset?a.dataset[b]=c:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.setAttribute("data-"+b,c))}function N(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function O(a,b){function c(a){h(a+" loaded"),++e==f&&b()}function d(a,b,c){var d;"css"===b?(d=document.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=a,"function"==typeof c&&c(a)):"js"===b&&(d=document.createElement("script"),d.type="text/javascript",d.readyState?d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,"function"==typeof c&&c(a))}:(d.onload=function(){"function"==typeof c&&c(a)},d.onerror=function(){j("error loading "+a)}),d.src=a),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)}var e=0,f=a.length;if(0===f)return void b();for(var g=0;f>g;)d(a[g].url,a[g].type,c),g++}function P(){if(!Ca.isAdmin)return void j("can't open editor, admin not logged");if("undefined"==typeof wysihtml5){if(wa>=1)return void j("error loading editor library.");wa++,h("editor library not yet loaded. perform loading now...");var a=[];return a.push({url:sa+"/libs/wysihtml/wysihtml-toolbar.min.js",type:"js"}),void O(a,function(){a=[],a.push({url:sa+"/libs/wysihtml/parser_rules/advanced_and_extended.js",type:"js"}),O(a,function(){P()})})}Q()}function Q(){function b(b,d){if(!o(b)&&o(Da.editors))return(b.target||b.srcElement).removeEventListener("click",this),!1;var e=null,f=null,g=document.documentElement,h=Math.max(g.clientWidth,a.innerWidth||0);if(s()||d){var i=l.getBoundingClientRect();e=i.left+(l.offsetWidth/2-m.offsetWidth/2),f=i.top-m.offsetHeight-5}else{var j=null,k=null;if(document.selection&&document.selection.createRange)k=document.selection.createRange(),j={top:k.offsetTop,left:k.offsetLeft};else if(a.getSelection&&a.getSelection().rangeCount>0){k=a.getSelection().getRangeAt(0).cloneRange();var n=k.getBoundingClientRect();j={top:n.top,left:n.left}}if(!o(j)){var p=m.offsetWidth/2;e=j.left-p+5,5>e?e=5:e>h-p-5&&(e=h-p-5),f=j.top-m.offsetHeight-20}}if(null!==e||null!==f){var q=(a.pageXOffset||g.scrollLeft)-(g.clientLeft||0),r=(a.pageYOffset||g.scrollTop)-(g.clientTop||0);e+=q,f+=r;var t=!0,u=parseInt(m.style.left,10);isNaN(u)&&(t=!1);var v=parseInt(m.style.top,10);return isNaN(v)&&(t=!1),m.style.visibility="visible",t?(K(m,"left","px",!1,Math.ceil(u),Math.ceil(e),300),K(m,"top","px",!1,Math.ceil(v),Math.ceil(f),300)):(m.style.left=Math.ceil(e)+"px",m.style.top=Math.ceil(f)+"px"),!0}return c(),!1}function c(){A(m,"ebl-sticky")||I(m)}function d(a){for(var c="textarea"===a,d=m.querySelectorAll(".ebl-button, .ebl-separator"),e=0;e<d.length;e++)c?I(d[e]):H(d[e]);var f=m.querySelector(".ebl-action-editor-html");c?(C(f,"ebl-icon-file-code-o"),B(f,"ebl-icon-file-text-o","ebl-icon-2x"),f.title=eblLang.editor_toolbar_closeHTML,H(f),B(m,"ebl-sticky")):(C(f,"ebl-icon-file-text-o","ebl-icon-2x"),B(f,"ebl-icon-file-code-o"),f.title=eblLang.editor_toolbar_editHTML,C(m,"ebl-sticky")),b({},!0)}function e(){var b=Da.editors.title,c=b.getBoundingClientRect(),d=c.left+(b.offsetWidth/2-k.offsetWidth/2),e=c.top-k.offsetHeight-5,f=document.documentElement,g=(a.pageXOffset||f.scrollLeft)-(f.clientLeft||0),h=(a.pageYOffset||f.scrollTop)-(f.clientTop||0);return d+=g,e+=h,k.style.left=Math.ceil(d)+"px",k.style.top=Math.ceil(e)+"px",k.style.visibility="visible",!0}function f(){I(k)}function g(a){var b=a.keyCode||a.which;return 13==b?(a.preventDefault(),!1):void 0}var h={},i=Ca.container.querySelector(Da.post.status===Ba.NEW?".ebl-post-new":".ebl-post-singleview#ebl-post_"+Da.post.id),j=i.querySelector(".ebl-post-title");B(j,"ebl-editable"),j.contentEditable=!0,Da.post.status===Ba.NEW?j.innerHTML=eblLang.editor_placeholder_title:j.oldValue=j.innerHTML;var k=Ca.container.querySelector(".ebl-title-toolbar");o(k)&&(k=ja()),h.title=j,v(h.title,"keypress",g),v(h.title,"focus",e),v(h.title,"blur",f);var l=i.querySelector(".ebl-post-body");B(l,"ebl-editable"),l.oldValue=l.innerHTML;var m=Ca.container.querySelector(".ebl-editor-toolbar");if(o(m)&&(m=ia()),h.content=new wysihtml5.Editor(l,{name:"ebl-editor-body",style:!1,showToolbarAfterInit:!1,parserRules:wysihtml5ParserRules,uneditableContainerClassname:!1,useLineBreaks:!1,toolbar:m}),Da.post.status===Ba.NEW&&h.content.setValue("<p>"+eblLang.editor_placeholder_content+"</p>"),h.content.on("newword:composer",b),h.content.on("show:dialog",function(){B(m,"ebl-sticky")}),h.content.on("cancel:dialog",function(){C(m,"ebl-sticky")}),h.content.on("blur",c),h.content.on("change_view",d),v(l,"click",b),Da.editors=h,Da.post.status===Ba.NEW)for(var n=i.querySelectorAll(".ebl-comments"),p=0;p<n.length;++p)J(n[p])}function R(a){if(I(Ca.container.querySelector(".ebl-editor-toolbar")),!o(Da.editors)){var b=Da.editors.title,c=Da.editors.content;b.blur(),b.contentEditable=!1,C(b,"ebl-editable"),a&&!o(b.oldValue)&&(b.innerHTML=b.oldValue),q(b,"oldValue"),c.destroy(),C(c.editableElement,"ebl-editable"),Da.editors=null}}function S(a){if(o(Da.editors))return void j("there is no active editor.");var b=Da.editors.title;b.oldValue=b.innerHTML;var c=encodeURIComponent(r((b.textContent||b.innerText).trim()));if(0===c.length)return void fa(xa.ERROR,eblLang.editor_missingTitle);var d=Da.editors.content;"source"==d.currentView&&d.fire("change_view","composer");var e=encodeURIComponent(d.getValue()),g=d.editableElement;g.oldValue=g.innerHTML,o(Da.post.tags)&&(Da.post.tags=[]);var h=JSON.stringify(Da.post.tags),i=Da.post.status===Ba.NEW,k=i?"action=publish_post&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0):"action=update_post&id="+Da.post.id+"&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0);k+="&token="+Ca.authToken,z(ua.DATA,k,"POST",!0,function(){da()},function(b){ea();var c=b.meta.id;Da.post.id=c,Da.post.status=a?Ba.DRAFT:Ba.PUBLISHED,a||(R(),f(c,i)),a?fa(xa.SUCCESS,eblLang.editor_saved):i?fa(xa.SUCCESS,eblLang.editor_published):fa(xa.SUCCESS,eblLang.editor_updated)},function(a,b){ea(),fa(xa.FATAL,"I can't publish this document: "+r(b))})}function T(a,b){R(),z(ua.RENDER,"action=get_post&id="+a+n(Ca.config,"template"),"GET",!0,function(){da()},function(c){ea();var d=Ca.container;J(d.querySelector("ebl-template")),d.insertAdjacentHTML("beforeend",c);var e=d.querySelector("ebl-template"),f=Da.post;f.id=L(e,"eblPostId"),f.status=Ba.parse(L(e,"eblPostStatus")),f.title=L(e,"eblPostTitle"),f.createdAt=y(L(e,"eblPostCreatedat")),f.updatedAt=y(L(e,"eblPostUpdatedat")),f.tags=w(L(e,"eblPostTags")),F(e),W(e),X(e),na(f.title),b===!0&&P(),ha();var g=Ca.config.onPostOpened;"function"==typeof g&&g(a)},function(a,b){ea();var c=Ca.container;J(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function U(){z(ua.RENDER,"action=get_html&ebl-new=1"+n(Ca.config,"template"),"GET",!0,function(){da()},function(a){ea();var b=Ca.container;J(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template"),d=Da.post;d.status=Ba.NEW;for(var e=c.querySelectorAll(".ebl-comments"),f=0;f<e.length;++f)J(e[f]);F(c),W(c),X(c),na(eblLang.editor_placeholder_title),P(),ha()},function(a,b){ea();var c=Ca.container;J(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function V(){R(),z(ua.RENDER,"action=get_page&number="+Da.page+n(Ca.config,"template","postsPerPage"),"GET",!0,function(){da()},function(a){ea();var b=Ca.container;J(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template");Da.page=parseInt(L(c,"eblPageNum"),0),q(Da,"post"),F(c),W(c),X(c),na(null),ha();var d=Ca.config.onPageChanged;"function"==typeof d&&d(Da.page)},function(a,b){ea();var c=Ca.container;J(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function W(b){for(var c=b.querySelectorAll(".ebl-post-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d=document.documentElement||document.body;K(d,"scrollTop","",!0,d.scrollTop,Ca.container.offsetTop-40,400,function(){f(c.substring(c.lastIndexOf("?ebl-post=")+"?ebl-post=".length),!1)})}:i("found a post link but it's not an <a> tag! seamless navigation is disabled.")}}function X(b){for(var c=b.querySelectorAll(".ebl-nav-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d={};d.page=parseInt(c.substring(c.lastIndexOf("?ebl-page=")+"?ebl-page=".length),10);var e=l(a.location.search,"ebl-page",d.page);e=m(e,"ebl-post");var f=document.documentElement||document.body;K(f,"scrollTop","",!0,f.scrollTop,Ca.container.offsetTop-40,400,function(){la(d,null,e),V()})}:i("found a nav link but it's not an <a> tag! seamless navigation is disabled for it.")}}function Y(){var a=Ca.container.querySelector(".ebl-adminbar");Ca.isAdmin?(ha(),H(a)):(R(),I(a))}function Z(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&fa(xa.ERROR,eblLang.init_shortPassword)):void z(ua.DATA,"action=init_repository&psw="+a,"POST",!0,null,function(a){c&&c.close(),Ca.isAdmin=!0,Ca.authToken=a.data.attributes.token,fa(xa.SUCCESS,eblLang.init_ok),Y()},function(a,b){fa(xa.FATAL,"can't initialize database: "+b)})}if(Ca.isAdmin)return void j("can't show dialog, admin already exists and it's logged.");if(u()){var b=alertify.prompt(),c=b.elements.footer.querySelector("button.ajs-cancel");I(c),b.set({title:eblLang.init_title,message:eblLang.init_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var d=prompt(eblLang.init_message,"");d&&a(d)}}function $(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&fa(xa.ERROR,eblLang.login_badPassword)):void z(ua.DATA,"action=log_in&psw="+a,"POST",!0,null,function(a){Ca.isAdmin=!0,Ca.authToken=a.data.attributes.token,fa(xa.SUCCESS,eblLang.login_ok),c&&c.close(),Y(),o(Da.post)&&e()},function(a,b){if(a===va.EBL_ERROR_AUTH_SHORTACCESS);else if(a===va.EBL_ERROR_AUTH_NOTLOGGED)fa(xa.ERROR,eblLang.login_badPassword);else{var d="login error: "+b;c&&c.close(),fa(xa.FATAL,d),j(b)}})}if(Ca.isAdmin)return void i("already logged in.");if(u()){var b=alertify.prompt();b.set({title:eblLang.login_title,message:eblLang.login_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var c=prompt(eblLang.login_message,"");c&&a(c)}}function _(){function a(){z(ua.DATA,"action=log_out","POST",!0,function(){da()},function(a){if(ea(),Ca.isAdmin=!1,Ca.authToken=null,Y(),o(Da.post))e();else{var b=Ca.container.querySelector(".ebl-post-singleview#ebl-post_"+Da.post.id);A(b,"ebl-draft")&&e()}},function(a,b){ea(),fa(xa.FATAL,b)})}if(!Ca.isAdmin)return void j("can't show dialog, user already logged out.");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.logout_message,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.logout_message);c&&a()}}function aa(a){function b(){z(ua.DATA,"action=delete_post&id="+a+"&token="+Ca.authToken,"POST",!0,function(){da()},function(a){ea(),fa(xa.SUCCESS,eblLang.deletepost_ok),q(Da.post),V()},function(a,b){ea(),fa(xa.FATAL,"error while deleting: "+b)})}if(!Ca.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.confirm();c.set({title:"",message:eblLang.deletepost_confirm,modal:!0,movable:!1,onok:b}),c.show()}else{var d=confirm(eblLang.deletepost_confirm);d&&b()}}function ba(a){if(!Ca.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.redraft_confirm,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.redraft_confirm);c&&a()}}function ca(a,b){if(!Ca.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.prompt(),d=c.elements.body.querySelector("input.ajs-input");d.placeholder=eblLang.tags_placeholder,c.set({title:eblLang.tags_title,message:eblLang.tags_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,type:"text",labels:{ok:eblLang.general_ok},value:a,onok:function(a,c){b(c)}}),c.show()}else{var e=prompt(eblLang.tags_message);e&&b(e)}}function da(){var a=Ca.container,b=a.querySelector(".ebl-loading-overlay");if(o(b)){b=document.createElement("div"),B(b,"ebl-loading-overlay","ebl-unselectable");var c=document.createElement("div");B(c,"fa","fa-cog","fa-spin","fa-4x"),b.appendChild(c),G(a,b)}a.style.position="relative",B(b,"visible")}function ea(){var a=Ca.container,b=a.querySelector(".ebl-loading-overlay");a.style.position="static",C(b,"visible")}function fa(a,b){a==xa.SUCCESS?u()?alertify.success(b):alert(b):a==xa.ERROR?u()?alertify.error(b):alert(b):a==xa.FATAL&&(u()?alertify.alert("",'<p class="ebl-error">'+eblLang.general_fatalError+'</p><pre class="ebl-pre">'+b+"</pre>"):alert(b))}function ga(){var b=document.createElement("div");B(b,"ebl-adminbar","ebl-unselectable"),b.origDisplay="block",b.style.display="none";var c=document.createElement("div");B(c,"ebl-adminbar-new");var d=D("ebl-action-new");B(d,"fa","ebl-icon-2x","ebl-icon-plus-square-o"),d.onclick=function(){g()},c.appendChild(E(d,eblLang.button_addNew));var e=document.createElement("div");B(e,"ebl-adminbar-edit");var f=D("ebl-action-edit");B(f,"fa","ebl-icon-2x","ebl-icon-pencil-square-o"),f.onclick=function(){var b=p(Da);b.post.edit=!0;var c=l(a.location.search,"ebl-edit","1");la(b,null,c),P(),ha()};var h=D("ebl-action-delete");B(h,"fa","ebl-icon-2x","ebl-icon-trash-o"),h.onclick=function(){aa(Da.post.id)},e.appendChild(E(f,eblLang.button_editPost)),e.appendChild(E(h,eblLang.button_deletePost));var i=document.createElement("div");B(i,"ebl-adminbar-publish");var j=D("ebl-action-save");B(j,"fa","ebl-icon-2x","ebl-icon-floppy-o"),j.onclick=function(){Da.post.status==Ba.PUBLISHED?ba(function(){S(!0)}):S(!0)};var k=D("ebl-action-publish");B(k,"fa","ebl-icon-2x","ebl-icon-cloud-upload"),k.onclick=function(){S(!1)};var m=D("ebl-action-cancel");B(m,"fa","ebl-icon-2x","ebl-icon-close"),m.onclick=function(){R(!0),ma()},i.appendChild(E(j,eblLang.button_saveDraft)),i.appendChild(E(k,eblLang.button_publishPost)),i.appendChild(E(m,eblLang.general_cancel));var n=D("ebl-action-logout");B(n,"fa","ebl-icon-2x","ebl-icon-sign-out"),n.onclick=function(){_()},b.appendChild(c),b.appendChild(e),b.appendChild(i),b.appendChild(n),G(Ca.container,b),ha()}function ha(){var a=Ca.container,b=a.querySelector(".ebl-adminbar-new"),c=a.querySelector(".ebl-adminbar-publish"),d=a.querySelector(".ebl-adminbar-edit");o(Da.post)?(H(b),I(c),I(d)):Da.post.edit===!0?(I(b),H(c),I(d)):(I(b),I(c),H(d))}function ia(){var a=document.createElement("div");B(a,"ebl-toolbar","ebl-editor-toolbar");var b=document.createElement("span");B(b,"ebl-separator");var c=document.createElement("div"),d=D("ebl-action-editor-undo",eblLang.editor_toolbar_undo);B(d,"fa","ebl-icon-rotate-left"),M(d,"wysihtml5Command","undo");var e=D("ebl-action-editor-bold",eblLang.editor_toolbar_textBold);B(e,"fa","ebl-icon-bold"),M(e,"wysihtml5Command","bold");var f=D("ebl-action-editor-italic",eblLang.editor_toolbar_textItalic);B(f,"fa","ebl-icon-italic"),M(f,"wysihtml5Command","italic");var g=D("ebl-action-editor-underline",eblLang.editor_toolbar_textUnderline);B(g,"fa","ebl-icon-underline"),M(g,"wysihtml5Command","underline");var h=D("ebl-action-editor-h1",eblLang.editor_toolbar_textH1);B(h,"fa","ebl-icon-header"),M(h,"wysihtml5Command","formatBlock"),M(h,"wysihtml5CommandValue","h1");var i=D("ebl-action-editor-alignleft",eblLang.editor_toolbar_textAlignLeft);B(i,"fa","ebl-icon-align-left"),M(i,"wysihtml5Command","justifyLeft");var j=D("ebl-action-editor-aligncenter",eblLang.editor_toolbar_textAlignCenter);B(j,"fa","ebl-icon-align-center"),M(j,"wysihtml5Command","justifyCenter");var k=D("ebl-action-editor-alignright",eblLang.editor_toolbar_textAlignRight);B(k,"fa","ebl-icon-align-right"),M(k,"wysihtml5Command","justifyRight");var l=D("ebl-action-editor-addul",eblLang.editor_toolbar_addUl);B(l,"fa","ebl-icon-list-ul"),M(l,"wysihtml5Command","insertUnorderedList");var m=D("ebl-action-editor-addol",eblLang.editor_toolbar_addOl);B(m,"fa","ebl-icon-list-ol"),M(m,"wysihtml5Command","insertOrderedList");var n=D("ebl-action-editor-addimage",eblLang.editor_toolbar_addImage);B(n,"fa","ebl-icon-image"),M(n,"wysihtml5Command","insertImage");var o=D("ebl-action-editor-addlink",eblLang.editor_toolbar_addLink);B(o,"fa","ebl-icon-chain"),M(o,"wysihtml5Command","createLink");var p=D("ebl-action-editor-html",eblLang.editor_toolbar_editHTML);B(p,"fa","ebl-icon-file-code-o"),M(p,"wysihtml5Action","change_view"),c.appendChild(d),c.appendChild(b.cloneNode(!0)),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(b.cloneNode(!0)),c.appendChild(i),c.appendChild(j),c.appendChild(k),c.appendChild(b.cloneNode(!0)),c.appendChild(l),c.appendChild(m),c.appendChild(b.cloneNode(!0)),c.appendChild(n),c.appendChild(o),c.appendChild(b.cloneNode(!0)),c.appendChild(p);var q=document.createElement("div");M(q,"wysihtml5Dialog","insertImage"),B(q,"ebl-editor-toolbar-sub","toolbar-sub-2");var r=document.createElement("input");M(r,"wysihtml5DialogField","src"),r.type="text",r.value="http://";var s=D("ebl-action-editor-image-save",eblLang.editor_toolbar_addImage);s.innerHTML=eblLang.editor_toolbar_addImage,M(s,"wysihtml5DialogAction","save"),q.appendChild(r),q.appendChild(s),I(q);var t=document.createElement("div");M(t,"wysihtml5Dialog","createLink"),B(t,"ebl-editor-toolbar-sub","toolbar-sub-2");var u=document.createElement("input");M(u,"wysihtml5DialogField","href"),u.type="text",u.value="http://";var v=D("ebl-action-editor-link-save",eblLang.editor_toolbar_addLink);return v.innerHTML=eblLang.editor_toolbar_addLink,M(v,"wysihtml5DialogAction","save"),t.appendChild(u),t.appendChild(v),I(t),a.appendChild(c),a.appendChild(q),a.appendChild(t),a.style.visibility="hidden",G(Ca.container,a),a}function ja(){var a=document.createElement("div");B(a,"ebl-toolbar","ebl-title-toolbar");var b=D("ebl-action-title-tag",eblLang.title_toolbar_tags);return B(b,"fa","ebl-icon-tags"),b.onmousedown=function(){ca(x(Da.post.tags),function(a){Da.post.tags=w(a)})},a.appendChild(b),a.style.visibility="hidden",G(Ca.container,a),a}function ka(){return oa()?void v(a,"popstate",function(a){a.state&&a.state.hasOwnProperty("ebl")&&(Da=a.state.ebl,o(Da.post)?V():Da.post.status===Ba.NEW?U():T(Da.post.id,Da.post.edit))},!1):void i("this browser does not support History API. seamless navigation is disabled.")}function la(b,c,d,e){if(oa()){var f=history.state;o(f)&&(f={}),f.ebl=Da=b,e?history.replaceState(f,null,d):history.pushState(f,null,d)}else e||(a.location.search=d);e||(ya=!0)}function ma(b){ya?a.history.back(b):V()}function na(a){if(!o(Ca.config.pageTitleFormat)){var b=Ca.originalTitle,c=null;c=o(a)?b:Ca.config.pageTitleFormat.replace(/{original_title}/,b).replace(/{ebl_title}/,r(a));try{document.getElementsByTagName("title")[0].innerHTML=c}catch(d){}document.title=c}}function oa(){return!(!a.history||!history.pushState)}var pa=a.Ebl={};pa.version="0.0.1";var qa=!0,ra=document.getElementsByTagName("script"),sa=ra[ra.length-1].src.split("?")[0].split("/").slice(0,-1).join("/");a.getComputedStyle||(a.getComputedStyle=function(a,b){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e-1,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),pa.init=function(a,b){d(a,b)},pa.showLogin=function(){$()},pa.openPreviews=function(){e()},pa.openPost=function(a){f(a,!1)},pa.createNew=function(){g()};var ta=function(){};ta.extend=function(a,b){var c=ta.prototype.extend;ta._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete ta._prototyping;var e=d.constructor,f=d.constructor=function(){if(!ta._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},ta.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||ta.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=ta.toString}this[a]=b}else if(a){var e=ta.prototype.extend;ta._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=ta._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},ta=ta.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,c,d){for(var e in a)this.prototype[e]===b&&c.call(d,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var ua={DATA:"data",RENDER:"render"},va={EBL_SUCCESS:200,EBL_ERROR_BADREQUEST:400,EBL_ERROR_AUTH_NOTLOGGED:401,EBL_ERROR_NOTFOUND:404,EBL_ERROR_AUTH_SHORTACCESS:429,EBL_ERROR_AUTH_NOADMIN:450,EBL_ERROR_AUTH_ALREADYADMIN:451,EBL_ERROR_AUTH_TOOMANYADMINS:452,EBL_ERROR_INTERNAL:500,EBL_ERROR_DB_ACCESS:550,EBL_ERROR_DB_INSERT:551,EBL_ERROR_DB_UPDATE:552},wa=0;document.createElement("ebl-template"),document.createElement("header"),document.createElement("time"),document.createElement("nav"),document.createElement("article");var xa={FATAL:0,ERROR:1,SUCCESS:2},ya=!1,za=ta.extend({constructor:function(){this.isAdmin=!1,this.authToken=null,this.originalTitle=null,this.container=null,this.config={template:"default",language:"en",postsPerPage:5,pageTitleFormat:"{original_title} | {ebl_title}",onBlogLoaded:null,onPostOpened:null,onPageChanged:null}}}),Aa=ta.extend({constructor:function(){this.page=0,this.post=null,this.editors=null}}),Ba={NEW:0,DRAFT:1,PUBLISHED:2,parse:function(a){return"new"==a.toLowerCase()?0:"draft"==a.toLowerCase()?1:"published"==a.toLowerCase()?2:null}},Ca=new za,Da=new Aa}(window);