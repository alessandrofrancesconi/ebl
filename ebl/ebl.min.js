/*! Ebl - v0.0.1 (2015-09-18) */
!function(a,b){"use strict";function c(){var b=Ba.container=document.querySelector(".ebl-container");if(!o(b)){Ba.originalTitle=document.title;var c=b.querySelector("ebl-template"),d=K(c,"eblType");if("page"==d){var e=parseInt(K(c,"eblPageNum"),10);Ca.page=isNaN(e)?0:e}else if("post"==d){var f={};if(f.status=Aa.parse(K(c,"eblPostStatus")),f.status!=Aa.NEW){f.id=K(c,"eblPostId"),f.title=K(c,"eblPostTitle"),f.tags=w(K(c,"eblPostTags"));var g=k(location.search,"ebl-edit");null!==g&&1==parseInt(g,10)&&(f.edit=!0),ma(f.title)}else f.edit=!0;Ca.post=f}var h=[];h.push({url:ra+"/languages/"+Ba.config.language+".js",type:"js"}),h.push({url:ra+"/css/base.css",type:"css"}),h.push({url:ra+"/css/font-awesome/css/font-awesome.min.css",type:"css"}),u()||t()||(h.push({url:ra+"/libs/alertify/alertify.min.js",type:"js"}),h.push({url:ra+"/libs/alertify/css/alertify.min.css",type:"css"}),h.push({url:ra+"/libs/alertify/css/themes/default.min.css",type:"css"})),N(h,function(){ka(Ca,null,null,!0),ja(),fa();var b=Ba.container;E(b),V(b),W(b),y(ta.DATA,"action=get_session","GET",!0,null,function(b){Ba.isAdmin=b.data.attributes.logged,Ba.isAdmin===!0&&(Ba.authToken=b.data.attributes.token),X(),!o(Ca.post)&&Ca.post.edit&&O(),"#ebl-login"==a.location.hash&&Z()},function(a,b){if(Ba.isAdmin=!1,Ba.authToken=null,X(),a===ua.EBL_ERROR_AUTH_NOADMIN)Y();else{var c=a===ua.EBL_ERROR_DB_ACCESS?"There is a problem connecting to the DB: "+b.message:"General error: "+b.message;ea(wa.FATAL,c)}}),v(a,"beforeunload",function(a){return o(Ca.editors)?void 0:eblLang.editor_closeWarning}),v(a,"hashchange",function(b){"#ebl-login"==a.location.hash&&Z()});var c=Ba.config.onBlogLoaded;"function"==typeof c&&c()})}}function d(a,b){var d=null;if(M(a)?d=a:"string"==typeof a&&(d=document.getElementById(a)),o(d))return void j("can't create Ebl on invalid element");if(!o(b))for(var e in b)b.hasOwnProperty(e)&&(Ba.config[e]=b[e]);var f,g,h,i="",l=!1;null!==(f=k(location.search,"ebl-post"))&&(i+="&ebl-post="+f,l=!0),l||null===(g=k(location.search,"ebl-page"))||(i+="&ebl-page="+parseInt(g,10),l=!0),l||null===(h=k(location.search,"ebl-new"))||1!=parseInt(h,10)||(i+="&ebl-new=1",l=!0),y(ta.RENDER,"action=get_html"+i+n(Ba.config,"template","postsPerPage"),"GET",!1,null,function(a){d.insertAdjacentHTML("beforeend",a),c()},function(a,b){d.insertAdjacentHTML("beforeend",b)})}function e(b){var c=new za;c.page=b?b:0;var d=l(a.location.search,"ebl-page",c.page);d=m(d,"ebl-post"),d=m(d,"ebl-edit"),d=m(d,"ebl-new"),ka(c,null,d),U()}function f(b,c){var d=new za;d.post={id:b};var e=l(a.location.search,"ebl-post",d.post.id);e=m(e,"ebl-edit"),e=m(e,"ebl-page"),e=m(e,"ebl-new"),ka(d,null,e,c),S(d.post.id)}function g(){if(!Ba.isAdmin)return void j("can't open editor, admin not logged");var b={};b.post={edit:!0,status:Aa.NEW};var c=l(a.location.search,"ebl-new","1");c=m(c,"ebl-post"),c=m(c,"ebl-edit"),c=m(c,"ebl-page"),ka(b,null,c),T()}function h(a){pa&&console.log("[Ebl v"+oa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function i(a){console.warn("[Ebl v"+oa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function j(a){console.error("[Ebl v"+oa.version+"] "+a.replace(/(\r\n|\n|\r)/gm,""))}function k(a,b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a)||[,""])[1].replace(/\+/g,"%20"))||null}function l(a,b,c){if(a.indexOf(b+"=")>=0){var d=a.substring(0,a.indexOf(b)),e=a.substring(a.indexOf(b));e=e.substring(e.indexOf("=")+1),e=e.indexOf("&")>=0?e.substring(e.indexOf("&")):"",a=d+b+"="+c+e}else a+=a.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;return a}function m(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-->0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);a=c[0]+"?"+e.join("&")}return-1!==a.indexOf("?",a.length-1)&&a.slice(0,-1),a}function n(a){function b(a){return"_"+a.toLowerCase()}for(var c="",d=[],e=1;e<arguments.length;++e)d.push(arguments[e]);for(var f in a)if(!(d.length>0&&-1==d.indexOf(f))){var g=a[f];if(!o(g)&&"function"!=typeof g){"boolean"==typeof g&&(g=g?1:0);var h=f.replace(/([A-Z])/g,b);c+="&"+h+"="+g}}return c}function o(a){return"undefined"==typeof a||null===a}function p(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(a,c){a[c]=b;try{delete a[c]}catch(d){}}function r(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function t(){for(var a=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0];);if(4>=a){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/);a=e?parseInt(e[1]):b}return 9>a}function u(){return!("undefined"==typeof alertify)}function v(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c)}function w(a){for(var b=[],c=a.split(","),d=[],e=0;e<c.length;++e){var f={id:c[e].trim()};f.id.length>0&&-1==d.indexOf(f.id)&&(b.push(f),d.push(f.id))}return b}function x(a){for(var b="",c=0;c<a.length;++c)b+=a[c].id,c<a.length-1&&(b+=", ");return b}function y(b,c,d,e,f,g,i){h("sending request... params: "+c+" | type: "+b+" | method: "+d+" | async: "+e);var k=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");k.onreadystatechange=function(){if(k.readyState<4)"function"==typeof f&&f();else if(4==k.readyState){k.onreadystatechange=null;var a=k.responseText;if(200==k.status)h("response from "+b+" API: "+a),"function"==typeof g&&g(b==ta.RENDER?a:JSON.parse(a));else{var c=null;c=b==ta.RENDER?a:JSON.parse(a).errors[0].message,j("error "+k.status+" from "+b+" API: "+c),"function"==typeof i&&i(k.status,c)}}};try{"GET"==d?(k.open(d,ra+"/api/"+b+".php?"+c,e),k.send(null)):"POST"==d&&(k.open(d,ra+"/api/"+b+".php",e),k.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),k.send(c))}catch(l){j("error connecting to Ebl API: "+l)}}function z(a,b){return null!==a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function A(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];z(a,c)||(a.className.length>0&&(a.className+=" "),a.className+=c)}}function B(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(z(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d," "),a.className=a.className.trim()}}}function C(a,b){var c=document.createElement("button");return A(c,"ebl-button"),a&&A(c,a),b&&(c.title=b),c}function D(a,b){var c=document.createElement("span");return L(c,"tooltip",b),c.appendChild(a),c}function E(a){for(var b=a.getElementsByTagName("script"),c=0;c<b.length;c++){var d=document.createElement("script");d.innerHTML=b[c].innerHTML,b[c].parentNode.appendChild(d),b[c].parentNode.removeChild(b[c])}}function F(a,b){a.insertBefore(b,a.childNodes[0])}function G(a){o(a)||(o(a.origDisplay)?a.style.display="inline-block":a.style.display=a.origDisplay)}function H(a){o(a)||(z(a,"ebl-toolbar")?a.style.visibility="hidden":(o(a.origDisplay)&&(a.origDisplay=a.currentStyle?a.currentStyle.display:getComputedStyle(a,null).display),a.style.display="none"))}function I(a){o(a)||a.parentNode.removeChild(a)}function J(a,b,c,d,e,f,g,i){h("animating with values: "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g);var j=(new Date).getTime(),k=setInterval(function(){var h=Math.min(1,((new Date).getTime()-j)/g);d?a[b]=e+l(h)*(f-e)+c:a.style[b]=e+l(h)*(f-e)+c,1==h&&(clearInterval(k),"function"==typeof i&&i())},10);d?a[b]=e+c:a.style[b]=e+c;var l=function(a){return.5>a?2*a*a:-1+(4-2*a)*a}}function K(a,b){return a.dataset?a.dataset[b]:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.getAttribute("data-"+b))}function L(a,b,c){a.dataset?a.dataset[b]=c:(b=b.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}),a.setAttribute("data-"+b,c))}function M(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function N(a,b){function c(a){h(a+" loaded"),++e==f&&b()}function d(a,b,c){var d;"css"===b?(d=document.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=a,"function"==typeof c&&c(a)):"js"===b&&(d=document.createElement("script"),d.type="text/javascript",d.readyState?d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,"function"==typeof c&&c(a))}:(d.onload=function(){"function"==typeof c&&c(a)},d.onerror=function(){j("error loading "+a)}),d.src=a),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)}var e=0,f=a.length;if(0===f)return void b();for(var g=0;f>g;)d(a[g].url,a[g].type,c),g++}function O(){if(!Ba.isAdmin)return void j("can't open editor, admin not logged");if("undefined"==typeof wysihtml5){if(va>=1)return void j("error loading editor library.");va++,h("editor library not yet loaded. perform loading now...");var a=[];return a.push({url:ra+"/libs/wysihtml/wysihtml-toolbar.min.js",type:"js"}),void N(a,function(){a=[],a.push({url:ra+"/libs/wysihtml/parser_rules/advanced_and_extended.js",type:"js"}),N(a,function(){O()})})}P()}function P(){function b(b,d){if(!o(b)&&o(Ca.editors))return(b.target||b.srcElement).removeEventListener("click",this),!1;var e=null,f=null,g=document.documentElement,h=Math.max(g.clientWidth,a.innerWidth||0);if(s()||d){var i=l.getBoundingClientRect();e=i.left+(l.offsetWidth/2-m.offsetWidth/2),f=i.top-m.offsetHeight-5}else{var j=null,k=null;if(document.selection&&document.selection.createRange)k=document.selection.createRange(),j={top:k.offsetTop,left:k.offsetLeft};else if(a.getSelection&&a.getSelection().rangeCount>0){k=a.getSelection().getRangeAt(0).cloneRange();var n=k.getBoundingClientRect();j={top:n.top,left:n.left}}if(!o(j)){var p=m.offsetWidth/2;e=j.left-p+5,5>e?e=5:e>h-p-5&&(e=h-p-5),f=j.top-m.offsetHeight-20}}if(null!==e||null!==f){var q=(a.pageXOffset||g.scrollLeft)-(g.clientLeft||0),r=(a.pageYOffset||g.scrollTop)-(g.clientTop||0);e+=q,f+=r;var t=!0,u=parseInt(m.style.left,10);isNaN(u)&&(t=!1);var v=parseInt(m.style.top,10);return isNaN(v)&&(t=!1),m.style.visibility="visible",t?(J(m,"left","px",!1,Math.ceil(u),Math.ceil(e),300),J(m,"top","px",!1,Math.ceil(v),Math.ceil(f),300)):(m.style.left=Math.ceil(e)+"px",m.style.top=Math.ceil(f)+"px"),!0}return c(),!1}function c(){z(m,"ebl-sticky")||H(m)}function d(a){for(var c="textarea"===a,d=m.querySelectorAll(".ebl-button, .ebl-separator"),e=0;e<d.length;e++)c?H(d[e]):G(d[e]);var f=m.querySelector(".ebl-action-editor-html");c?(B(f,"fa-file-code-o"),A(f,"fa-file-text-o","fa-2x"),f.title=eblLang.editor_toolbar_closeHTML,G(f),A(m,"ebl-sticky")):(B(f,"fa-file-text-o","fa-2x"),A(f,"fa-file-code-o"),f.title=eblLang.editor_toolbar_editHTML,B(m,"ebl-sticky")),b({},!0)}function e(){var b=Ca.editors.title,c=b.getBoundingClientRect(),d=c.left+(b.offsetWidth/2-k.offsetWidth/2),e=c.top-k.offsetHeight-5,f=document.documentElement,g=(a.pageXOffset||f.scrollLeft)-(f.clientLeft||0),h=(a.pageYOffset||f.scrollTop)-(f.clientTop||0);return d+=g,e+=h,k.style.left=Math.ceil(d)+"px",k.style.top=Math.ceil(e)+"px",k.style.visibility="visible",!0}function f(){H(k)}function g(a){var b=a.keyCode||a.which;return 13==b?(a.preventDefault(),!1):void 0}var h={},i=Ba.container.querySelector(Ca.post.status===Aa.NEW?".ebl-post-new":".ebl-post-singleview#ebl-post_"+Ca.post.id),j=i.querySelector(".ebl-post-title");A(j,"ebl-editable"),j.contentEditable=!0,Ca.post.status===Aa.NEW?j.innerHTML=eblLang.editor_placeholder_title:j.oldValue=j.innerHTML;var k=Ba.container.querySelector(".ebl-title-toolbar");o(k)&&(k=ia()),h.title=j,v(h.title,"keypress",g),v(h.title,"focus",e),v(h.title,"blur",f);var l=i.querySelector(".ebl-post-body");A(l,"ebl-editable"),l.oldValue=l.innerHTML;var m=Ba.container.querySelector(".ebl-editor-toolbar");if(o(m)&&(m=ha()),h.content=new wysihtml5.Editor(l,{name:"ebl-editor-body",style:!1,showToolbarAfterInit:!1,parserRules:wysihtml5ParserRules,uneditableContainerClassname:!1,useLineBreaks:!1,toolbar:m}),Ca.post.status===Aa.NEW&&h.content.setValue("<p>"+eblLang.editor_placeholder_content+"</p>"),h.content.on("newword:composer",b),h.content.on("show:dialog",function(){A(m,"ebl-sticky")}),h.content.on("cancel:dialog",function(){B(m,"ebl-sticky")}),h.content.on("blur",c),h.content.on("change_view",d),v(l,"click",b),Ca.editors=h,Ca.post.status===Aa.NEW)for(var n=i.querySelectorAll(".ebl-comments"),p=0;p<n.length;++p)I(n[p])}function Q(a){if(H(Ba.container.querySelector(".ebl-editor-toolbar")),!o(Ca.editors)){var b=Ca.editors.title,c=Ca.editors.content;b.blur(),b.contentEditable=!1,B(b,"ebl-editable"),a&&!o(b.oldValue)&&(b.innerHTML=b.oldValue),q(b,"oldValue"),c.destroy(),B(c.editableElement,"ebl-editable"),Ca.editors=null}}function R(a){if(o(Ca.editors))return void j("there is no active editor.");var b=Ca.editors.title;b.oldValue=b.innerHTML;var c=encodeURIComponent(r((b.textContent||b.innerText).trim()));if(0===c.length)return void ea(wa.ERROR,eblLang.editor_missingTitle);var d=Ca.editors.content;"source"==d.currentView&&d.fire("change_view","composer");var e=encodeURIComponent(d.getValue()),g=d.editableElement;g.oldValue=g.innerHTML,o(Ca.post.tags)&&(Ca.post.tags=[]);var h=JSON.stringify(Ca.post.tags),i=Ca.post.status===Aa.NEW,k=i?"action=publish_post&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0):"action=update_post&id="+Ca.post.id+"&title="+c+"&body="+e+"&tags="+h+"&draft="+(a?1:0);k+="&token="+Ba.authToken,y(ta.DATA,k,"POST",!0,function(){ca()},function(b){da();var c=b.meta.id;Ca.post.id=c,Ca.post.status=a?Aa.DRAFT:Aa.PUBLISHED,a||(Q(),f(c,i)),a?ea(wa.SUCCESS,eblLang.editor_saved):i?ea(wa.SUCCESS,eblLang.editor_published):ea(wa.SUCCESS,eblLang.editor_updated)},function(a,b){da(),ea(wa.FATAL,"I can't publish this document: "+r(b))})}function S(a,b){Q(),y(ta.RENDER,"action=get_post&id="+a+n(Ba.config,"template"),"GET",!0,function(){ca()},function(c){da();var d=Ba.container;I(d.querySelector("ebl-template")),d.insertAdjacentHTML("beforeend",c);var e=d.querySelector("ebl-template"),f=Ca.post;f.id=K(e,"eblPostId"),f.status=Aa.parse(K(e,"eblPostStatus")),f.title=K(e,"eblPostTitle"),f.tags=[];for(var g=K(e,"eblPostTags").split(","),h=0;h<g.length;++h)f.tags.push({id:g[h]});E(e),V(e),W(e),ma(f.title),b===!0&&O(),ga();var i=Ba.config.onPostOpened;"function"==typeof i&&i(a)},function(a,b){da();var c=Ba.container;I(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function T(){y(ta.RENDER,"action=get_html&ebl-new=1"+n(Ba.config,"template"),"GET",!0,function(){ca()},function(a){da();var b=Ba.container;I(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template"),d=Ca.post;d.status=Aa.NEW;for(var e=c.querySelectorAll(".ebl-comments"),f=0;f<e.length;++f)I(e[f]);E(c),V(c),W(c),ma(eblLang.editor_placeholder_title),O(),ga()},function(a,b){da();var c=Ba.container;I(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function U(){Q(),y(ta.RENDER,"action=get_page&number="+Ca.page+n(Ba.config,"template","postsPerPage"),"GET",!0,function(){ca()},function(a){da();var b=Ba.container;I(b.querySelector("ebl-template")),b.insertAdjacentHTML("beforeend",a);var c=b.querySelector("ebl-template");Ca.page=parseInt(K(c,"eblPageNum"),0),q(Ca,"post"),E(c),V(c),W(c),ma(null),ga();var d=Ba.config.onPageChanged;"function"==typeof d&&d(Ca.page)},function(a,b){da();var c=Ba.container;I(c.querySelector("ebl-template")),c.insertAdjacentHTML("beforeend",b)})}function V(b){for(var c=b.querySelectorAll(".ebl-post-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d=document.documentElement||document.body;J(d,"scrollTop","",!0,d.scrollTop,Ba.container.offsetTop-40,400,function(){f(c.substring(c.lastIndexOf("?ebl-post=")+"?ebl-post=".length),!1)})}:i("found a post link but it's not an <a> tag! seamless navigation is disabled.")}}function W(b){for(var c=b.querySelectorAll(".ebl-nav-link"),d=0;d<c.length;d++){var e=c[d];"A"===e.tagName?e.onclick=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=(b.target||b.srcElement).href,d={};d.page=parseInt(c.substring(c.lastIndexOf("?ebl-page=")+"?ebl-page=".length),10);var e=l(a.location.search,"ebl-page",d.page);e=m(e,"ebl-post");var f=document.documentElement||document.body;J(f,"scrollTop","",!0,f.scrollTop,Ba.container.offsetTop-40,400,function(){ka(d,null,e),U()})}:i("found a nav link but it's not an <a> tag! seamless navigation is disabled for it.")}}function X(){var a=Ba.container.querySelector(".ebl-adminbar");Ba.isAdmin?(ga(),G(a)):(Q(),H(a))}function Y(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ea(wa.ERROR,eblLang.init_shortPassword)):void y(ta.DATA,"action=init_repository&psw="+a,"POST",!0,null,function(a){c&&c.close(),Ba.isAdmin=!0,Ba.authToken=a.data.attributes.token,ea(wa.SUCCESS,eblLang.init_ok),X()},function(a,b){ea(wa.FATAL,"can't initialize database: "+b)})}if(Ba.isAdmin)return void j("can't show dialog, admin already exists and it's logged.");if(u()){var b=alertify.prompt(),c=b.elements.footer.querySelector("button.ajs-cancel");H(c),b.set({title:eblLang.init_title,message:eblLang.init_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var d=prompt(eblLang.init_message,"");d&&a(d)}}function Z(){function a(a,b,c){return b&&(b.cancel=!0),a.length<5?void(a.length>0&&ea(wa.ERROR,eblLang.login_badPassword)):void y(ta.DATA,"action=log_in&psw="+a,"POST",!0,null,function(a){Ba.isAdmin=!0,Ba.authToken=a.data.attributes.token,ea(wa.SUCCESS,eblLang.login_ok),c&&c.close(),X(),o(Ca.post)&&e()},function(a,b){if(a===ua.EBL_ERROR_AUTH_SHORTACCESS);else if(a===ua.EBL_ERROR_AUTH_NOTLOGGED)ea(wa.ERROR,eblLang.login_badPassword);else{var d="login error: "+b;c&&c.close(),ea(wa.FATAL,d),j(b)}})}if(Ba.isAdmin)return void i("already logged in.");if(u()){var b=alertify.prompt();b.set({title:eblLang.login_title,message:eblLang.login_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,labels:{ok:eblLang.general_ok},type:"password",value:"",onok:function(b,c){a(c,b,this)}}),b.show()}else{var c=prompt(eblLang.login_message,"");c&&a(c)}}function $(){function a(){y(ta.DATA,"action=log_out","POST",!0,function(){ca()},function(a){if(da(),Ba.isAdmin=!1,Ba.authToken=null,X(),o(Ca.post))e();else{var b=Ba.container.querySelector(".ebl-post-singleview#ebl-post_"+Ca.post.id);z(b,"ebl-draft")&&e()}},function(a,b){da(),ea(wa.FATAL,b)})}if(!Ba.isAdmin)return void j("can't show dialog, user already logged out.");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.logout_message,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.logout_message);c&&a()}}function _(a){function b(){y(ta.DATA,"action=delete_post&id="+a+"&token="+Ba.authToken,"POST",!0,function(){ca()},function(a){da(),ea(wa.SUCCESS,eblLang.deletepost_ok),q(Ca.post),U()},function(a,b){da(),ea(wa.FATAL,"error while deleting: "+b)})}if(!Ba.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.confirm();c.set({title:"",message:eblLang.deletepost_confirm,modal:!0,movable:!1,onok:b}),c.show()}else{var d=confirm(eblLang.deletepost_confirm);d&&b()}}function aa(a){if(!Ba.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var b=alertify.confirm();b.set({title:"",message:eblLang.redraft_confirm,modal:!0,movable:!1,onok:a}),b.show()}else{var c=confirm(eblLang.redraft_confirm);c&&a()}}function ba(a,b){if(!Ba.isAdmin)return void j("can't show dialog, admin not logged");if(u()){var c=alertify.prompt(),d=c.elements.body.querySelector("input.ajs-input");d.placeholder=eblLang.tags_placeholder,c.set({title:eblLang.tags_title,message:eblLang.tags_message,closable:!1,movable:!1,resizable:!1,maximizable:!1,type:"text",labels:{ok:eblLang.general_ok},value:a,onok:function(a,c){b(c)}}),c.show()}else{var e=prompt(eblLang.tags_message);e&&b(e)}}function ca(){var a=Ba.container,b=a.querySelector(".ebl-loading-overlay");if(o(b)){b=document.createElement("div"),A(b,"ebl-loading-overlay","ebl-unselectable");var c=document.createElement("div");A(c,"fa","fa-cog","fa-spin","fa-4x"),b.appendChild(c),F(a,b)}a.style.position="relative",A(b,"visible")}function da(){var a=Ba.container,b=a.querySelector(".ebl-loading-overlay");a.style.position="static",B(b,"visible")}function ea(a,b){a==wa.SUCCESS?u()?alertify.success(b):alert(b):a==wa.ERROR?u()?alertify.error(b):alert(b):a==wa.FATAL&&(u()?alertify.alert("",'<p class="ebl-error">'+eblLang.general_fatalError+'</p><pre class="ebl-pre">'+b+"</pre>"):alert(b))}function fa(){var b=document.createElement("div");A(b,"ebl-adminbar","ebl-unselectable"),b.origDisplay="block",b.style.display="none";var c=document.createElement("div");A(c,"ebl-adminbar-new");var d=C("ebl-action-new");A(d,"fa","fa-2x","fa-plus-square-o"),d.onclick=function(){g()},c.appendChild(D(d,eblLang.button_addNew));var e=document.createElement("div");A(e,"ebl-adminbar-edit");var f=C("ebl-action-edit");A(f,"fa","fa-2x","fa-pencil-square-o"),f.onclick=function(){var b=p(Ca);b.post.edit=!0;var c=l(a.location.search,"ebl-edit","1");ka(b,null,c),O(),ga()};var h=C("ebl-action-delete");A(h,"fa","fa-2x","fa-trash-o"),h.onclick=function(){_(Ca.post.id)},e.appendChild(D(f,eblLang.button_editPost)),e.appendChild(D(h,eblLang.button_deletePost));var i=document.createElement("div");A(i,"ebl-adminbar-publish");var j=C("ebl-action-save");A(j,"fa","fa-2x","fa-floppy-o"),j.onclick=function(){Ca.post.status==Aa.PUBLISHED?aa(function(){R(!0)}):R(!0)};var k=C("ebl-action-publish");A(k,"fa","fa-2x","fa-cloud-upload"),k.onclick=function(){R(!1)};var m=C("ebl-action-cancel");A(m,"fa","fa-2x","fa-times"),m.onclick=function(){Q(!0),la()},i.appendChild(D(j,eblLang.button_saveDraft)),i.appendChild(D(k,eblLang.button_publishPost)),i.appendChild(D(m,eblLang.general_cancel));var n=C("ebl-action-logout");A(n,"fa","fa-2x","fa-sign-out"),n.onclick=function(){$()},b.appendChild(c),b.appendChild(e),b.appendChild(i),b.appendChild(n),F(Ba.container,b),ga()}function ga(){var a=Ba.container,b=a.querySelector(".ebl-adminbar-new"),c=a.querySelector(".ebl-adminbar-publish"),d=a.querySelector(".ebl-adminbar-edit");o(Ca.post)?(G(b),H(c),H(d)):Ca.post.edit===!0?(H(b),G(c),H(d)):(H(b),H(c),G(d))}function ha(){var a=document.createElement("div");A(a,"ebl-toolbar","ebl-editor-toolbar");var b=document.createElement("span");A(b,"ebl-separator");var c=document.createElement("div"),d=C("ebl-action-editor-undo",eblLang.editor_toolbar_undo);A(d,"fa","fa-undo"),L(d,"wysihtml5Command","undo");var e=C("ebl-action-editor-bold",eblLang.editor_toolbar_textBold);A(e,"fa","fa-bold"),L(e,"wysihtml5Command","bold");var f=C("ebl-action-editor-italic",eblLang.editor_toolbar_textItalic);A(f,"fa","fa-italic"),L(f,"wysihtml5Command","italic");var g=C("ebl-action-editor-underline",eblLang.editor_toolbar_textUnderline);A(g,"fa","fa-underline"),L(g,"wysihtml5Command","underline");var h=C("ebl-action-editor-h1",eblLang.editor_toolbar_textH1);A(h,"fa","fa-header"),L(h,"wysihtml5Command","formatBlock"),L(h,"wysihtml5CommandValue","h1");var i=C("ebl-action-editor-alignleft",eblLang.editor_toolbar_textAlignLeft);A(i,"fa","fa-align-left"),L(i,"wysihtml5Command","justifyLeft");var j=C("ebl-action-editor-aligncenter",eblLang.editor_toolbar_textAlignCenter);A(j,"fa","fa-align-center"),L(j,"wysihtml5Command","justifyCenter");var k=C("ebl-action-editor-alignright",eblLang.editor_toolbar_textAlignRight);A(k,"fa","fa-align-right"),L(k,"wysihtml5Command","justifyRight");var l=C("ebl-action-editor-addul",eblLang.editor_toolbar_addUl);A(l,"fa","fa-list-ul"),L(l,"wysihtml5Command","insertUnorderedList");var m=C("ebl-action-editor-addol",eblLang.editor_toolbar_addOl);A(m,"fa","fa-list-ol"),L(m,"wysihtml5Command","insertOrderedList");var n=C("ebl-action-editor-addimage",eblLang.editor_toolbar_addImage);A(n,"fa","fa-picture-o"),L(n,"wysihtml5Command","insertImage");var o=C("ebl-action-editor-addlink",eblLang.editor_toolbar_addLink);A(o,"fa","fa-link"),L(o,"wysihtml5Command","createLink");var p=C("ebl-action-editor-html",eblLang.editor_toolbar_editHTML);A(p,"fa","fa-file-code-o"),L(p,"wysihtml5Action","change_view"),c.appendChild(d),c.appendChild(b.cloneNode(!0)),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(b.cloneNode(!0)),c.appendChild(i),c.appendChild(j),c.appendChild(k),c.appendChild(b.cloneNode(!0)),c.appendChild(l),c.appendChild(m),c.appendChild(b.cloneNode(!0)),c.appendChild(n),c.appendChild(o),c.appendChild(b.cloneNode(!0)),c.appendChild(p);var q=document.createElement("div");L(q,"wysihtml5Dialog","insertImage"),A(q,"ebl-editor-toolbar-sub","toolbar-sub-2");var r=document.createElement("input");L(r,"wysihtml5DialogField","src"),r.type="text",r.value="http://";var s=C("ebl-action-editor-image-save",eblLang.editor_toolbar_addImage);s.innerHTML=eblLang.editor_toolbar_addImage,L(s,"wysihtml5DialogAction","save"),q.appendChild(r),q.appendChild(s),H(q);var t=document.createElement("div");L(t,"wysihtml5Dialog","createLink"),A(t,"ebl-editor-toolbar-sub","toolbar-sub-2");var u=document.createElement("input");L(u,"wysihtml5DialogField","href"),u.type="text",u.value="http://";var v=C("ebl-action-editor-link-save",eblLang.editor_toolbar_addLink);return v.innerHTML=eblLang.editor_toolbar_addLink,L(v,"wysihtml5DialogAction","save"),t.appendChild(u),t.appendChild(v),H(t),a.appendChild(c),a.appendChild(q),a.appendChild(t),a.style.visibility="hidden",F(Ba.container,a),a}function ia(){var a=document.createElement("div");A(a,"ebl-toolbar","ebl-title-toolbar");var b=C("ebl-action-title-tag",eblLang.title_toolbar_tags);return A(b,"fa","fa-tags"),b.onmousedown=function(){ba(x(Ca.post.tags),function(a){Ca.post.tags=w(a)})},a.appendChild(b),a.style.visibility="hidden",F(Ba.container,a),a}function ja(){return na()?void v(a,"popstate",function(a){a.state&&a.state.hasOwnProperty("ebl")&&(Ca=a.state.ebl,o(Ca.post)?U():Ca.post.status===Aa.NEW?T():S(Ca.post.id,Ca.post.edit))},!1):void i("this browser does not support History API. seamless navigation is disabled.")}function ka(b,c,d,e){if(na()){var f=history.state;o(f)&&(f={}),f.ebl=Ca=b,e?history.replaceState(f,null,d):history.pushState(f,null,d)}else e||(a.location.search=d);e||(xa=!0)}function la(b){xa?a.history.back(b):U()}function ma(a){if(!o(Ba.config.pageTitleFormat)){var b=Ba.originalTitle,c=null;c=o(a)?b:Ba.config.pageTitleFormat.replace(/{original_title}/,b).replace(/{ebl_title}/,r(a));try{document.getElementsByTagName("title")[0].innerHTML=c}catch(d){}document.title=c}}function na(){return!(!a.history||!history.pushState)}var oa=a.Ebl={};oa.version="0.0.1";var pa=!0,qa=document.getElementsByTagName("script"),ra=qa[qa.length-1].src.split("?")[0].split("/").slice(0,-1).join("/");a.getComputedStyle||(a.getComputedStyle=function(a,b){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;for(b=e-1,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),c=b>=0?Math.min(b,e-1):e-Math.abs(b);c>=0;c--)if(c in d&&d[c]===a)return c;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),oa.init=function(a,b){d(a,b)},oa.showLogin=function(){Z()},oa.openPreviews=function(){e()},oa.openPost=function(a){f(a,!1)},oa.createNew=function(){g()};var sa=function(){};sa.extend=function(a,b){var c=sa.prototype.extend;sa._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete sa._prototyping;var e=d.constructor,f=d.constructor=function(){if(!sa._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},sa.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||sa.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=sa.toString}this[a]=b}else if(a){var e=sa.prototype.extend;sa._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=sa._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},sa=sa.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,c,d){for(var e in a)this.prototype[e]===b&&c.call(d,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var ta={DATA:"data",RENDER:"render"},ua={EBL_SUCCESS:200,EBL_ERROR_BADREQUEST:400,EBL_ERROR_AUTH_NOTLOGGED:401,EBL_ERROR_NOTFOUND:404,EBL_ERROR_AUTH_SHORTACCESS:429,EBL_ERROR_AUTH_NOADMIN:450,EBL_ERROR_AUTH_ALREADYADMIN:451,EBL_ERROR_AUTH_TOOMANYADMINS:452,EBL_ERROR_INTERNAL:500,EBL_ERROR_DB_ACCESS:550,EBL_ERROR_DB_INSERT:551,EBL_ERROR_DB_UPDATE:552},va=0;document.createElement("ebl-template"),document.createElement("header"),document.createElement("time"),document.createElement("nav"),document.createElement("article");var wa={FATAL:0,ERROR:1,SUCCESS:2},xa=!1,ya=sa.extend({constructor:function(){this.isAdmin=!1,this.authToken=null,this.originalTitle=null,this.container=null,this.config={template:"default",language:"en",postsPerPage:5,pageTitleFormat:"{original_title} | {ebl_title}",onBlogLoaded:null,onPostOpened:null,onPageChanged:null}}}),za=sa.extend({constructor:function(){this.page=0,this.post=null,this.editors=null}}),Aa={NEW:0,DRAFT:1,PUBLISHED:2,parse:function(a){return"new"==a.toLowerCase()?0:"draft"==a.toLowerCase()?1:"published"==a.toLowerCase()?2:null}},Ba=new ya,Ca=new za}(window);